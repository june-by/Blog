---
title: "SPA SEO with Lamda@Edge"
date: "2023-05-24"
lastmod: "2023-05-24"
category: "Web"
tags: ["spa", "seo", "cloud front"]
description: "CloudFront, Lambda@Edgeë¥¼ í™œìš©í•´ SPAì—ì„œ SEOë¥¼ ë‹¤ë£¨ëŠ” ë‚´ìš©ì— ê´€í•œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/ec4d85e2-e967-42e7-8918-406d433c1a86"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fbyjuun.com%2Fposts%2FWeb%2Fspa-seo&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

ìµœê·¼ì— íŒ€ì›ë¶„ê³¼Â `SSR`ì— ê´€í•œ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.

ê·¸ ë¶„ê»˜ì„œÂ `SSR`ì˜ í•µì‹¬ì€Â `â€œFirstPaintê°€ ë¹¨ë¼ì§„ë‹¤â€`,Â `â€œSEOâ€`Â ì´ëŸ°ê²Œ ì•„ë‹ˆë¼,Â **ë Œë”ë§ì„ ì„œë²„**ì—ì„œ í•˜ëŠ” ê²ƒì´ë¼ê³  ë§ì”€í•˜ì…¨ìŠµë‹ˆë‹¤.

`SEO`ê°€ ëª©ì ì¼ ê²½ìš°ì˜ ê²½ìš°,Â `SSR`Â ì—†ì´,Â `CloudFront`ì™€Â `Lamda@Edge`ë¥¼ ì´ìš©í•´, ì²˜ë¦¬ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì´ì•¼ê¸°ë¥¼ ë“£ê³ , ìë£Œë¥¼ ì°¾ì•„ë³´ê³  ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

# ğŸ›  React ê¸°ë³¸ ì„¸íŒ…

`CRA`ë¥¼ í†µí•´,Â `React`Â í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ë‚´ìš©ì€ ë”°ë¡œ ì±„ìš°ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (`SEO`Â ëª©ì )

```jsx
import React from "react";

function App() {
  return <div>App</div>;
}

export default App;
```

<br />

# ğŸ–¥ CloudFront ë°°í¬

`React`Â í”„ë¡œì íŠ¸ë¥¼Â `CloudFront`ì— ë°°í¬ í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ëœ ê¸€ì€ ë§ê¸° ë•Œë¬¸ì—, ìƒëµí•©ë‹ˆë‹¤.

<br />

# ğŸ¤” Lambda@Edge and CloudFront

`CloudFront`ì™€Â `Lamda@Edge`ê°€ ì •í™•íˆ ë¬´ì—‡ì¸ì§€, ìì„¸í•œ ì„¤ëª…ì´ í•„ìš”í•˜ë‹¤ë©´ ì•„ë˜ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ëë‹ˆë‹¤.

- [What is AWS CloudFront?](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Introduction.html)

- [What is Lambda@edge?](https://aws.amazon.com/ko/lambda/edge/)

ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ìë©´, ë¨¼ì €Â `CloudFront`ëŠ”Â `AWS`ì—ì„œ ì œê³µí•˜ëŠ”Â `CDN`ì…ë‹ˆë‹¤.

ìºì‹±ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì¢€ ë” ë¹ ë¥´ê²Œ ì»¨í…ì¸ ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

ì „ ì„¸ê³„ì—Â `Edge Server`ë¥¼ ë‘ì–´, ìš”ì²­ì´ ë“¤ì–´ì˜¨Â `Client`ì— ê°€ì¥ ê°€ê¹Œìš´Â `Edge Server`ë¥¼ ì°¾ì•„Â `Latency`ë¥¼ ìµœì†Œí™” ì‹œí‚µë‹ˆë‹¤. (ê±°ë¦¬ì™€Â `Latency`ëŠ” ì •ë¹„ë¡€)

`Lambda@Edge`ëŠ”Â `CloudFront`ì˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ, ì‚¬ìš©ìì—ê²Œ ë” ê°€ê¹Œìš´ ìœ„ì¹˜ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•´ ì„±ëŠ¥ì„ ê°œì„ í•˜ê³  ì§€ì—° ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚¨ë‹¤.

ì¦‰,Â `CloudFront`ì™€ ê´€ë ¨ëœÂ `Request`,Â `Response`ì— íŠ¹ì • í•¨ìˆ˜ë¥¼ ë“±ë¡í•´ í•´ë‹¹ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ëŒ€ë§ˆë‹¤, ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ”ê²ƒì´ë‹¤.

`Lambda@Edge`ëŠ” ì •ë§ ë§ì€ ë¶€ë¶„ì—ì„œ í™œìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. (Image Resize, SEO, User Validation)

`CloudFront`ì™€Â `Lambda@Edge`ë¥¼ í™œìš©í•  ë•Œ, ì‚¬ìš©ìì˜ ìš”ì²­ê³¼ ì‘ë‹µì— ëŒ€í•œ Flowë¥¼ ê·¸ë¦¼ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

<img src="https://github.com/BY-juun/Blog/assets/78716842/f82f878e-944d-411f-b12d-1868a944af68" />

<br />

# ğŸ’¡ Basic Idea

`SEO`ë¥¼ ìœ„í•´ì„œëŠ”Â `Crawler Bot`ì´ í˜ì´ì§€ë¥¼ ìš”ì²­ í•  ë•Œ,Â `Meta tag`ê°€ ë“¤ì–´ìˆëŠ” í˜ì´ì§€ë¥¼ ë³´ë‚´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ì´ 2ê°€ì§€ì˜ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ìˆ˜í–‰í•©ë‹ˆë‹¤.

1. `Crawler Bot`ì„ íŒë‹¨í•©ë‹ˆë‹¤. â†’Â `Viewer Request`ë‹¨ê³„ì—ì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
2. ìš”ì²­ìê°€Â `Crawler Bot`ì¼ ê²½ìš°,Â `Meta Tag`ê°€ ë“¤ì–´ìˆëŠ” í˜ì´ì§€ë¥¼ ì‘ë‹µí•©ë‹ˆë‹¤. â†’Â `Origin Response`Â ë‹¨ê³„ì—ì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

`Crawler Bot`ì´ ì•„ë‹Œ ì¼ë°˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚´ëŠ” í˜ì´ì§€ì—ëŠ”Â `Meta Tag`ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ,Â `Origin Response`ì—ì„œÂ `Requester`ê°€Â `Crawler Bot`ìœ¼ë¡œ íŒë‹¨ë  ê²½ìš°, í˜ì´ì§€ë¥¼ ì‘ë‹µí•˜ëŠ”ê²Œ ì•„ë‹Œ, ì ì ˆíˆ ì„¸íŒ…í•œÂ `Meta Tag`ê°€ ë“¤ì–´ê°„Â `HTML`í˜•ì‹ì˜Â `String`ì„ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.

<br />

# âœï¸ Lambda@Edge í•¨ìˆ˜ ì‘ì„±

ì°¸ê³ )Â `CloudFront`ì—Â `Lambda@Edge`Â í•¨ìˆ˜ë¥¼ ë‹¬ê¸° ìœ„í•´ì„œëŠ”, ê¼­Â `us-east-1`ì—ì„œ ì‘ì„±ëœÂ `Lambda`í•¨ìˆ˜ë§Œ ê°€ëŠ¥í•˜ë‹¤.

## 1) Viwer Request Lambda Function

`Viwer Request`ì—ì„œ ë™ì‘í•˜ëŠ”Â `Lambda í•¨ìˆ˜`ëŠ”Â `Crawler Bot`ì„ íŒë‹¨í•˜ê³ , í—¤ë”ì— í¬ë¡¤ëŸ¬ ì—¬ë¶€ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

```jsx
const bot =
  /googlebot|bingbot|yandex|baiduspider|twitterbot|facebookexternalhit|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator|kakaotalk-scrap|yeti|naverbot|kakaostory-og-reader|daum/g;

exports.handler = (event, context, callback) => {
  const request = event.Records[0].cf.request;
  const user_agent = request.headers["user-agent"][0]["value"].toLowerCase();
  const referer = request.headers["referer"];

  request.headers["referer"] = [
    {
      key: "referer",
      value:
        Array.isArray(referer) && referer[0] !== undefined
          ? referer[0].value
          : request.headers["host"][0].value,
    },
  ];

  if (user_agent) {
    const found = user_agent.match(bot);
    request.headers["crawler"] = [
      {
        key: "crawler",
        value: `${!!found}`,
      },
    ];
  }
  callback(null, request);
};
```

## 2) Origin response Lambda Function

`Requester`ê°€Â `Crawler Bot`ì¸ ê²½ìš°,Â `Meta Tag`ê°€ ì‘ì„±ëœ,Â `HTML String`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```javascript
"use strict";
const TRUE = "true";

exports.handler = async (event, context, callback) => {
  const { request, response } = event.Records[0].cf;
  const { headers, uri } = request || {};
  const isCrawlerHeader = request.headers["crawler"];
  let isCrawler = false;
  if (
    Array.isArray(isCrawlerHeader) &&
    isCrawlerHeader[0].value !== undefined &&
    isCrawlerHeader[0].value !== null
  ) {
    isCrawler = isCrawlerHeader[0].value;
  }
  if (isCrawler === TRUE) {
    if (
      uri.includes("assets/") ||
      uri.includes(".html") ||
      uri.includes("robots.txt")
    ) {
      callback(null, response);
      return;
    }

    const body = `
    <html>
        <head>
            <meta property="og:locale" content="ko_KR" />
            <meta property="og:locale:alternate" content="en_US" />
            <meta
            name="description"
            content="ğŸ‘¨â€ğŸ’» ì•ˆë…•í•˜ì„¸ìš” ì‚¬ìš©ì ì¹œí™”ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ê³  ì‹¶ì€ ê°œë°œì ì•ˆë³‘ì¤€ì˜ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤."
            />
            <meta property="og:title" content="By_juun.com" />
            <meta
            property="og:description"
            content="ğŸ‘¨â€ğŸ’» ì•ˆë…•í•˜ì„¸ìš” ì‚¬ìš©ì ì¹œí™”ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ê³  ì‹¶ì€ ê°œë°œì ì•ˆë³‘ì¤€ì˜ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤."
            />
            <meta property="og:image" content={"<https://s3.ap-northeast-2.amazonaws.com/byjuun.com/original/Original.png>"} />
            <meta property="og:url" content="<https://byjuun.com>" />
        </head>
    </html>;
    `;

    response.headers = {
      ...response.headers,
      "content-type": [{ key: "Content-Type", value: "text/html" }],
    };
    response.status = "200";
    response.statusDescription = "OK";
    response.body = body;
    callback(null, response);
  } else {
    callback(null, response);
  }
};
```

<br />

# ë” ë‚˜ì•„ê°€â€¦

ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ì •ì ì¸Â `Meta Tag`ë¥¼ ë„£ì€Â `HTML`ì„ ë°˜í™˜í–ˆì§€ë§Œ,Â `Lambda@Function`Â ë‚´ì—ì„œÂ `Ajax`Â ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì´ì™€ ìš”ì²­ì„ ì¡°í•©í•´, ë™ì ì¸Â `Meta Tag`ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ìµœì í™”ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ”â€¦ ê²°êµ­Â `Body`Â ë‚´ë¶€ì˜ ì•„í‹°í´ì´ í•„ìš”í•˜ë‹¤ê³  í•©ë‹ˆë‹¤. (íŠ¹ì • í‚¤ì›Œë“œê°€ ëª‡ ë²ˆ ë‚˜íƒ€ë‚¬ëŠ”ì§€ ë“±ë“±â€¦)

`Meta Tag`ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ì‹ + ë‚´ë¶€ ì•„í‹°í´ì„ í•©ì³ì„œ ë³´ë‚´ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ìµœì í™”ì— ë” ìœ ë¦¬í•´ë³´ì…ë‹ˆë‹¤.

ìœ„ì—ì„œë„ ì–¸ê¸‰í–ˆë˜Â `SEO`ì´ì™¸,Â `Image Resizing`,Â `User Validation`,Â `ëª¨ë‹ˆí„°ë§`Â ë“±ë“± ë” ë§ì€ ê³³ì—Â `Lamda@Edge`ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì—ëŠ”, ê¸°íšŒê°€ ëœë‹¤ë©´Â `Lambda@Edge`ë¥¼ ì´ìš©í•œÂ `Image Resizing`ì„ ê³µë¶€í•˜ê³  ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤ :)

<br />

# ì •ë¦¬

`CloudFront`ì„ ìœ„í•œ ë°°í¬ì—ì„œ,Â `End User`ì™€Â `CloudFront`Â ì‚¬ì´,Â `CloudFront`ì™€Â `Origin(Ec2 Instance, S3)`ì‚¬ì´ì˜ ìš”ì²­ì—ì„œÂ `Lambda@Edge`Â í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ ì´ìš©í•´Â `SEO`,Â `Image Resizing`Â ê³¼ ê°™ì€ ì—¬ëŸ¬ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.

( +Â `SSR`ì˜ ì¤‘ìš”í•œ ì ì€Â `SEO`ê°€ ì•„ë‹Œ ì„œë²„ì—ì„œ ë Œë”ë§ í•œë‹¤ëŠ” ì ì´ë‹¤. )

<br />

# ì°¸ê³ ìë£Œ

- [https://www.youtube.com/watch?v=lUowbPD4N94](https://www.youtube.com/watch?v=lUowbPD4N94)

- [https://aws.amazon.com/ko/lambda/edge/](https://aws.amazon.com/ko/lambda/edge/)
