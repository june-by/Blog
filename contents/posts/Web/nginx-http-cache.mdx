---
title: "Nginxì—ì„œ HTTP Cache ì ìš©í•˜ê¸°"
date: "2022-11-30"
lastmod: "2022-11-30"
category: "Web"
tags: ["http", "nginx"]
series: "Frontend ì„±ëŠ¥ ìµœì í™”"
description: "ì •ì íŒŒì¼ì„ ì œê³µí•˜ëŠ” Nginx ì›¹ì„œë²„ì— HTTP Cacheë¥¼ ì ìš©í•˜ëŠ” ê³¼ì •ê³¼ ê²°ê³¼ì— ê´€í•œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/9337e043-547b-4d62-b313-f748d48e16ad"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdevlog-juneby.vercel.app%2Fposts%2FWeb%2Fnginx-http-cache&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

# ğŸŒŸë°°ê²½

ë„¤ì´ë²„ ë¶€ìŠ¤íŠ¸ìº í”„ íŒ€í”„ë¡œì íŠ¸ì¸ `fanup`ì˜ í´ë¼ì´ì–¸íŠ¸ëŠ” `React`ë¥¼ ì´ìš©í•´ ë§Œë“¤ì–´ì¡Œìœ¼ë©°, `Webpack`ì„ ì´ìš©í•´ ë¹Œë“œë©ë‹ˆë‹¤.  
ê·¸ í›„, ë¹Œë“œë¥¼ í†µí•´ ë§Œë“¤ì–´ì§„ static íŒŒì¼ë“¤(index.html, js, css, image â€¦.)ë“¤ì„ `Nginx`ë¥¼ í†µí•´ ì„œë¹™í•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤.

ì•„ë˜ë¥¼ ë³´ë©´, `Nginx`ì—ì„œëŠ” ê¸°ë³¸ `HTTP Cache-Control` ì„¤ì •ì€ `no-cache`ë¡œ í•´ë†“ì€ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img src="https://github.com/BY-juun/Blog/assets/78716842/efcc719a-cb16-4516-ab87-7c3b2bccc42f" />

`no-cache` ì„¤ì •ì˜ ê²½ìš°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤. â†’ <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Cache-Control#no-cache">cache-control : no-cache</a>

- ë°ì´í„°ë¥¼ ìºì‹œí•´ë„ ë˜ì§€ë§Œ, í•­ìƒ `origin` ì„œë²„ì— ê²€ì¦(Last-Modified, ETag)í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ë¼
- `origin` ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ëŠ” ì•Šì§€ë§Œ? **ê²€ì¦ì„ ìœ„í•œ ìš”ì²­**ì„ ë³´ë‚´ì•¼ í•œë‹¤

<br />
ì¶”ê°€ì ìœ¼ë¡œ, í¬ë¡¬ì˜ `LightHouse`ë¥¼ ì´ìš©í•œ ì„±ëŠ¥ ì¸¡ì •ì—ì„œë„, íš¨ìœ¨ì ì¸ ìºì‹œ ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬
ì •ì ì¸ ì—ì…‹ ì œê³µì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.

<img src="https://github.com/BY-juun/Blog/assets/78716842/1e67a8cb-70c6-42a7-bd8d-094a80337eb0" />

`Webpack`ì„ ì´ìš©í•´, ë¹Œë“œ ë˜ëŠ” ì„œë¹„ìŠ¤ëŠ” `js`, `css` íŒŒì¼ì˜ ë‚´ìš©ì´ ë³€í•˜ê²Œ ëœë‹¤ë©´, ë¹Œë“œê³¼ì •ì—ì„œ íŒŒì¼ì˜ ì´ë¦„ì´ ë°”ë€Œê²Œ ë©ë‹ˆë‹¤. (ex, `chunk.1234.js` â†’ `chunk.513dfrer.js`)

ìœ„ ìº¡ì²˜ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” js íŒŒì¼ì˜ ì´ë¦„ì€ `main.f42c0b67.js` ì…ë‹ˆë‹¤.  
`main` ë’¤ì— ë¶™ëŠ” `f42c0b67` ëŠ” js íŒŒì¼ì˜ ë‚´ìš©ì„ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ **í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ hash í•˜ëŠ” ê³¼ì •ì„ í†µí•´ ë‚˜ì˜¤ëŠ” ê°’**ì…ë‹ˆë‹¤.

> ë‹¤ì‹œ ë§í•´ì„œ, íŒŒì¼ì˜ ë‚´ìš©ì´ ë°”ë€Œë©´, main ë’¤ì— ë¶™ëŠ” ê°’ì´ ë°”ë€Œê³ , íŒŒì¼ì˜ ì´ë¦„ì´ ë°”ë€Œê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ë¹Œë“œë¥¼ í†µí•´ ë§Œë“¤ì–´ì§„, `index.html`ì—ì„œ ìš”ì²­í•˜ëŠ” js íŒŒì¼ì˜ ì´ë¦„ë„ í•¨ê»˜ ë³€í•˜ê²Œ ë©ë‹ˆë‹¤.

```html title="AS-IS"
<script src="chunk.1234.js" />
```

```html title="TO-BE"
<script src="chunk.513dfrer.js" />
```

ê·¸ë ‡ë‹¤ë©´? ì†ŒìŠ¤ì½”ë“œì˜ ë‹¤ìŒ ë²„ì „ì´ ë¹Œë“œë˜ê³  `Nginx`ë¥¼ í†µí•´ ì„œë¹™ë˜ê¸° ì „ê¹Œì§€ëŠ” í•­ìƒ ë™ì¼í•œ `js`íŒŒì¼ì„ ìš”ì²­í•œë‹¤ëŠ” ì˜ë¯¸ê°€ ë©ë‹ˆë‹¤. `css` íŒŒì¼ ë˜í•œ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.  
ì´ ì‚¬ì‹¤ì„ í†µí•´, `Nginx`ì˜ `cache-control` ì„¤ì •ì„ ë³€ê²½ì‹œì¼œ, ë§¤ë²ˆ ê²€ì¦í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

<br />

## ğŸŒŸÂ max-age?

ë¨¼ì €,Â `Cache-Control`Â í—¤ë”ì˜ ê°’ì„ ì–´ë–¤ ê°’ìœ¼ë¡œ ì„¤ì • í•  ì§€ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤.Â `Cache-Control`Â í—¤ë”ì—Â `max-age`Â ê°’ì„ ì„¤ì •í•˜ë©´, ì§€ì •í•œ ê°’ë§Œí¼ ë¦¬ì†ŒìŠ¤ë¥¼ ìºì‹œí•˜ê²Œ ë©ë‹ˆë‹¤.

ë¨¼ì €, íŒŒì¼ì„ ë‚˜ëˆ ì„œ ìƒê°í•´ë³´ì•˜ìŠµë‹ˆë‹¤.  
ê°€ì¥ ë¨¼ì €, ë£¨íŠ¸ê°€ ë˜ëŠ”Â `index.html`Â íŒŒì¼ì…ë‹ˆë‹¤.Â `index.html`ì˜ ê²½ìš°ì—ëŠ” ë¹Œë“œê°€ ë˜ì–´ë„ í•­ìƒ ë™ì¼í•œ íŒŒì¼ëª…ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.
ë”°ë¼ì„œ,Â `Cache-control`Â ì„¤ì •ì„Â `no-cache`ì—ì„œ íŠ¹ì • ê¸°ê°„ìœ¼ë¡œ ë°”ê¾¼ë‹¤ë©´,Â `Cache`ê°€ ë§Œë£Œë˜ëŠ” íŠ¹ì • ê¸°ê°„ ë™ì•ˆì€ ìƒˆë¡œìš´Â `index.html`Â íŒŒì¼ì„ ì„œë¹™ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. â†’ html íŒŒì¼ì— ëŒ€í•œ ì„¤ì •ì€ ë³€ê²½í•˜ì§€ ì•Šê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ,Â `js`,Â `css`Â íŒŒì¼ì…ë‹ˆë‹¤.Â `js`ì™€Â `css`íŒŒì¼ì€ ì´ì „ ë²„ì „ê³¼ ì¡°ê¸ˆì´ë¼ë„ ë‹¬ë¼ì§„ë‹¤ë©´, ë¹Œë“œëœ íŒŒì¼ì˜ ì´ë¦„ì€ ì´ì „ ë²„ì „ê³¼ ì•„ì˜ˆ ë‹¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤.

`index.html`Â íŒŒì¼ì€ í•­ìƒ ìƒˆë¡œìš´ ë²„ì „ì„ ì„œë¹™í•˜ê¸° ë•Œë¬¸ì—, ë§Œì•½Â `js`ì™€Â `css`íŒŒì¼ì´ ë³€í•œë‹¤ë©´ íŒŒì¼ì˜ ì´ë¦„ì´ ë‹¬ë¼ì§€ê³ ,Â `index.html`Â íŒŒì¼ì´ ìš”ì²­í•˜ëŠ”Â `js`,Â `css`Â íŒŒì¼ì˜ ì´ë¦„ë„ ë‹¬ë¼ì§ˆ ê²ƒì…ë‹ˆë‹¤.  
ë”°ë¼ì„œ,Â `js`ì™€Â `css`íŒŒì¼ì€Â `Cache`ê¸°ê°„ì„ ì–´ë–»ê²Œ ì„¤ì •í•˜ë˜ ìƒê´€ ì—†ì´ í•­ìƒ ìƒˆë¡œìš´ íŒŒì¼ì„ ì„œë¹™ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. â†’Â `js`ì™€Â `css`íŒŒì¼ì˜Â `Cache-Control`ì€ ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ìµœëŒ€ ê°’ì¸ ì¼ë…„ìœ¼ë¡œ ì„¤ì •í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, ì´ë¯¸ì§€ íŒŒì¼ì…ë‹ˆë‹¤. ì„œë¹„ìŠ¤ì˜ íŠ¹ì„± ìƒ, ì´ë¯¸ì§€ íŒŒì¼ ì—­ì‹œ, í•œë²ˆ íŠ¹ì • ì´ë¯¸ì§€ì— ëŒ€í•œ íŒŒì¼ì˜ ì´ë¦„ì´ ì •í•´ì§€ë©´, ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨ì„ í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ íŒŒì¼ì€ ê·¸ë˜ë„ ì–´ë–¤ ìƒí™©ì´ ë°œìƒí• ì§€ ëª¨ë¥´ë‹ˆ,Â `í•œë‹¬`ë¡œ ì„¤ì •í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸÂ Cache Control ë³€ê²½

`nginx config`Â íŒŒì¼ ë³€ê²½ì„ í†µí•´ì„œ, íŠ¹ì •Â `resource`ì— ëŒ€í•œÂ `header`ë¥¼ ë³€ê²½ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```conf title="AS-IS"
server {
        server_name fanup.live;
        root /root/web03-FanUP/client/build;
        location / {
            index index.html index.htm;
            try_files $uri $uri/ /index.html;
        }
        listen 443 ssl; # managed by Certbot
        ssl_certificate/etc/letsencrypt/live/fanup.live/fullchain.pem; # managed by Certbot
        ssl_certificate_key/etc/letsencrypt/live/fanup.live/privkey.pem; # managed by Certbot
        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
        ssl_dhparam/etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

```

```conf title="TO-BE" {8-17}
server {
        server_name fanup.live;
        root /root/web03-FanUP/client/build;
        location / {
            index index.html index.htm;
            try_files $uri $uri/ /index.html;
        }
        location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ {
Â  Â  Â  Â  Â  Â  Â  Â  expires 1M;
Â  Â  Â  Â  Â  Â  Â  Â  access_log off;
Â  Â  Â  Â  Â  Â  Â  Â  add_header Cache-Control "public";
Â  Â  Â  Â  }
Â  Â  Â  Â  location ~* \.(?:css|js)$ {
Â  Â  Â  Â  Â  Â  Â  Â  expires 1y;
Â  Â  Â  Â  Â  Â  Â  Â  access_log off;
Â  Â  Â  Â  Â  Â  Â  Â  add_header Cache-Control "public";
Â  Â  Â  Â  }
        listen 443 ssl; # managed by Certbot
        ssl_certificate/etc/letsencrypt/live/fanup.live/fullchain.pem; # managed by Certbot
        ssl_certificate_key/etc/letsencrypt/live/fanup.live/privkey.pem; # managed by Certbot
        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
        ssl_dhparam/etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

```

ì´ë¯¸ì§€ íŒŒì¼ì— ëŒ€í•œÂ `cache`Â ê¸°ê°„ì€ í•œ ë‹¬ë¡œ,Â `js`ì™€Â `css`íŒŒì¼ì— ëŒ€í•œÂ `cache`Â ê¸°ê°„ì€ 1ë…„ìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸ ê²°ê³¼

<img src="https://github.com/BY-juun/Blog/assets/78716842/49bd89da-e579-4510-adc9-28ee8fb3f96d" />
`cache`Â ì„¤ì •ì´ ì œëŒ€ë¡œ ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ,Â `js`,`css`,`img`Â íŒŒì¼ì— ëŒ€í•´ì„œëŠ”Â `max-age`Â ê¸°ê°„(1M, 1Y)ì´ ì§€ë‚˜ê¸° ì „ê¹Œì§€ëŠ” ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ì„œÂ `304 modified`Â ì‘ë‹µì„ ë°›ì„ í•„ìš”ê°€ ì—†ì´, ìºì‹œë¥¼ í†µí•´ ë”ìš± ë¹ ë¥¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
