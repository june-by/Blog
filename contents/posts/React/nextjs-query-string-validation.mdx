---
title: "NextJS í”„ë¡œì íŠ¸ì—ì„œ QueryString ê²€ì¦í•˜ê¸°"
date: "2023-05-29"
lastmod: "2023-05-29"
category: "React"
tags: ["nextjs", "hoc", "custom hooks"]
series: "Blog ê°œë°œì¼ì§€"
description: "ServerSideì™€ ClientSideì—ì„œ QueryStringì„ ê²€ì¦í•˜ëŠ” ì—¬ëŸ¬ íŒ¨í„´ê³¼ ë°©ë²•ì— ëŒ€í•´ ë‹¤ë£¬ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/d2e694eb-5ac6-4707-b8b9-2b831d4348e5"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdevlog-juneby.vercel.app%2Fposts%2FReact%2Fnextjs-query-string-validation&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

ë¼ìš°íŒ… ê¸°ëŠ¥ì´ í•„ìš”í•œ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ë‹¤ë³´ë©´, ë•Œë•Œë¡œÂ `QueryString`ì„ ê²€ì¦í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìƒê¹ë‹ˆë‹¤

ì œê°€ ë§Œë“  ë¸”ë¡œê·¸ì—ì„œëŠ” íŠ¹ì • ì£¼ì œì— ë§ëŠ” ê²Œì‹œê¸€ì„ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€ê°€ ìœ„ ê²½ìš°ì— í•´ë‹¹ ë˜ì—ˆìŠµë‹ˆë‹¤.

í•´ë‹¹ í˜ì´ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ì€Â `url`ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.

`/posts?category=JavaScript`Â â†’ ì¹´í…Œê³ ë¦¬ê°€Â `JavaScript`ì¸ ê²Œì‹œê¸€ ëª©ë¡

`/posts?tag=NextJS`Â â†’Â `NextJS`Â íƒœê·¸ê°€ ê±¸ë ¤ìˆëŠ” ê²Œì‹œê¸€ ëª©ë¡

`/posts?search=React`Â â†’Â `React`ê°€ ì œëª©ì— ë“¤ì–´ê°„ ê²Œì‹œê¸€ ëª©ë¡

ë”°ë¼ì„œ, í•´ë‹¹ ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€(`/posts`)ê°€Â `category`/`tag`/`search`Â ë¼ëŠ”Â `key`ê°€Â `QueryString`ì— ì—†ë‹¤ë©´ ì´ì— ëŒ€í•œ í•¸ë“¤ë§ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

<br />

# ğŸ›  HOC Pattern

`HOC(High Order Component) Pattern`ì€ ì¸ìë¡œ ë°›ì€ ì»´í¬ë„ŒíŠ¸ì— ê³µí†µëœ ì¶”ê°€ ë¡œì§ì„ ìˆ˜í–‰í•˜ì—¬ í•„ìš”í•œ ê²°ê³¼ë¬¼ì„ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. â†’Â [React ê³µì‹ë¬¸ì„œ High Order Component](https://ko.legacy.reactjs.org/docs/higher-order-components.html)

ìš”ì¦˜ì—ëŠ” ë³´í†µÂ `Custom Hook`Â íŒ¨í„´ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê°œì¸ì ìœ¼ë¡œÂ `ì»´í¬ë„ŒíŠ¸ì˜ ê²°ê³¼ë¬¼(return)`ì´ ê²°ì •ë˜ëŠ” ë¡œì§ì€Â `HOC Pattern`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ë…ì„±ì´ ì¢‹ë‹¤ê³  ìƒê°í•´ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

`HOC Pattern`ì„ ì‚¬ìš©í•´Â `QueryString`ì„ ê²€ì¦í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœê°€ ë  ê²ƒì…ë‹ˆë‹¤.

```tsx title="WithPostsQueryValidation.tsx"
function withPostsQueryValidation<P extends object>(
  Component: ComponentType<P>
) {
  return function WihLoadingComponent({ ...props }: P) {
    const [loading, setLoading] = useState(true);
    const { query } = useRouter();

    const isQueryInValid = !(query.search || query.tag || query.category);

    const queryInvalidCallBack = useCallback(() => {
      alert(MESSAGE.INVALIDE_ACCESS);
      window.location.replace("/");
    }, []);

    useEffect(() => {
      if (isQueryInValid) queryInvalidCallBack();
      else setLoading(false);
    }, [query, isQueryInValid]);

    if (loading) return <Loading />;

    return <Component {...props} />;
  };
}

export default withPostsQueryValidation;
```

<br />

```tsx title="ì‚¬ìš©ì²˜"
export default withPostsQueryValidation(Posts);
```

ê²€ì¦ ë¡œì§ì„Â `HOC`Â ë‚´ë¶€ì— ë‘ê³ ,Â `useEffect`ê°€ ì‹¤í–‰ë˜ì–´ ê²€ì¦ì´ ë˜ê¸°ì „ê¹Œì§€ëŠ”Â `LoadingComponent`ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜•íƒœì…ë‹ˆë‹¤.

<br />

# ğŸ›  Custom Hook Pattern

`Custom Hook`Â íŒ¨í„´ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤ë©´,Â `Hook`Â ë‚´ë¶€ì—ì„œ ê²€ì¦ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ”Â `HOC`ë¥¼ ë°˜í™˜í•˜ëŠ” í˜•íƒœë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•ì„œ, ë³´ì—¬ë“œë¦°Â `HOC`Â íŒ¨í„´ì€Â `invalidate`ì‹œì— ì‹¤í–‰í•˜ëŠ” ì½œë°±ì„ ë§¤ê²Œë³€ìˆ˜ë¡œ ì£¼ì…í•  ê²½ìš°,Â `Hook`ê³¼ ê´€ë ¨ëœ ë¡œì§ì„ ë„£ì„ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ,Â `Custom Hook`íŒ¨í„´ìœ¼ë¡œ ë³€ê²½í•  ê²½ìš°,Â `Hook`ì„ ì´ìš©í•œ ì½œë°±ì„ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx title="useSearchParamsValidation.ts"
interface Params {
  onInvalidate: () => void;
}

export default function useSearchParamsValidation({ onInvalidate }: Params) {
  const { query } = useRouter();

  const isQueryInValid = !(query.search || query.tag || query.category);

  const SearchParamsValidationWrap = ({
    children,
  }: {
    children: JSX.Element;
  }) => {
    const [loading, setLoading] = useState(false);

    useEffect(() => {
      if (isQueryInValid) onInvalidate();
      else setLoading(false);
    }, [isQueryInValid, onInvalidate]);

    if (loading) return null;
    return <>{children}</>;
  };

  return SearchParamsValidationWrap;
}
```

```tsx title="ì‚¬ìš©ì²˜" {14,16}
const Posts = () => {
  const router = useRouter();

  const onInvalidate = useCallback(() => {
    alert(MESSAGE.INVALIDE_ACCESS);
    router.push("/");
  }, []);

  const SearchParamsValidationWrap = useSearchParamsValidation({
    onInvalidate,
  });

  return (
    <SearchParamsValidationWrap>
      <>...</>
    </SearchParamsValidationWrap>
  );
};
```

ê²€ì¦ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ”Â `SerachParamsValidationWrap`Â `HOC`ë¥¼ í›…ì„ í†µí•´ ë°˜í™˜í•˜ê³ , í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ë°˜í™˜Â `JSX`ë¥¼ ê°ì‹¼ í›„(`children`),Â `validation`ì´ ë˜ì—ˆì„ ë•Œë§ŒÂ `children`ì„ ë°˜í™˜í•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤.

<br />

# ğŸ–¥ getServerSideProps

ì•ì„œ ë³´ì—¬ë“œë¦°Â `HOC`íŒ¨í„´ê³¼Â `Custom Hook`Â íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•œ ê°€ì§€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

ë°”ë¡œ ë‘ íŒ¨í„´ ëª¨ë‘Â `useEffect`ë¥¼ ì‚¬ìš©í•´ ê²€ì¦ì„ ì§„í–‰í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

`useEffect`ì˜ ë‚´ë¶€ ë¡œì§ì€Â `Server-Side`ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•Šê³ ,Â `Browser`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•˜ëŠ”Â `HTML`íŒŒì¼ì—ëŠ” ì–´ë–¤í•œ ê²½ìš°ì—ë„Â `Posts`Â ì»´í¬ë„ŒíŠ¸ê°€ ì•„ë‹ŒÂ `Loading`Â ì»´í¬ë„ŒíŠ¸ê°€ í¬í•¨ë˜ê²Œ ë©ë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ,Â `useEffect`Â ë‚´ë¶€ì—ì„œ ê²€ì¦ ë¡œì§ì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì„œë²„ì—ì„œ ë¼ìš°íŒ… ë‹¨ê³„ì— ê²€ì¦ ë¡œì§ì´ ì‹¤í–‰ë˜ë„ë¡ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

(ì„œë²„ì—ì„œ ë Œë”ë§í•  í•„ìš”ê°€ ì—†ì„ ê²½ìš°, ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ìƒê´€ ì—†ìŠµë‹ˆë‹¤ â†’Â `SSR x`Â `CSR o`)

`Browser`ê°€ ì•„ë‹ŒÂ `Server-Side`ì—ì„œ ìš”ì²­(Request)ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ì„œëŠ”Â `getServerSideProps`ë¥¼ ì´ìš©í•´ì•¼ í•©ë‹ˆë‹¤. (when using NextJS)

[ê³µì‹ë¬¸ì„œ](https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props#when-does-getserversideprops-run)ì—ëŠ”Â `getServerSideProps`ëŠ” ì˜¤ì§Â `Server-Side`ì—ì„œë§Œ ì‹¤í–‰ë˜ê³ ,Â `Browser`ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

`getServerSideProps`ë¥¼ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ëŠ” ìš”ì²­ì„ ë°›ì•˜ì„ ë•Œ,Â `getServerSideProps`Â ë¡œì§ì´ ì‹¤í–‰ë˜ê³ , ë°˜í™˜í•˜ëŠ”Â `prop`ê³¼ í•¨ê»˜ í˜ì´ì§€ë¥¼Â `pre-rendering`í•©ë‹ˆë‹¤. (ê³µì‹ë¬¸ì„œ ì„¤ëª…)

ì¶”ê°€ë¡œ,Â `getServerSideProps`ëŠ” í˜ì´ì§€ë¥¼Â `Redirect`ì‹œí‚¤ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì´ìš©í•´Â `QueryString`ì„ ê²€ì¦í•˜ê³  ì´ì— ë”°ë¥¸Â `Redirect`ì²˜ë¦¬ë¥¼ êµ¬í˜„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
export const getServerSideProps: GetServerSideProps = async ({
  req,
  res,
  query,
}) => {
  const isNumberOfKeyValid = verifyNumberOfKeys(Object.keys(query), 1);
  const isValueValid = verifyValue(query);

  if (!isNumberOfKeyValid || !isValueValid) {
    return {
      redirect: {
        permanent: false,
        destination: "/",
      },
      props: {},
    };
  }

  return {
    props: {},
  };
};

function verifyNumberOfKeys(keys: string[], validNumber: number) {
  const verifiedKeys = ["category", "search", "tag"];
  const includedKeys = keys.filter((key) => verifiedKeys.includes(key));
  return includedKeys.length === validNumber;
}

function verifyValue(query: ParsedUrlQuery) {
  for (const value of Object.values(query)) {
    if (!value) {
      return false;
    }
  }
  return true;
}
```

ì´ë²ˆ ê¸€ì—ì„œëŠ”Â `QueryString`Â ê²€ì¦ ê´€ë ¨ ë¡œì§ë§Œì„ ì´ì•¼ê¸° í–ˆì§€ë§Œ,Â `HOC`íŒ¨í„´ê³¼Â `getServerSideProps`ë¥¼ ì´ìš©í•´ ê´€ë¦¬ì ê²€ì¦, ë¡œê·¸ì¸ ì—¬ë¶€ ê²€ì¦, í† í° ê²€ì¦ ë“±ë“± ì—¬ëŸ¬ ë¶€ë¶„ì—ì„œë„ ë˜‘ê°™ì€ ë°©ì‹ìœ¼ë¡œ ê²€ì¦ ë¡œì§ì„ ì ìš©í•  ìˆ˜ ìˆì„ê²ƒì…ë‹ˆë‹¤.

<br />

# ğŸª with Cookie

ë‹¤ë§Œ, ê²€ì¦ê³¼ì •ì—ì„œÂ `Client`ì—ì„œ ì˜¨Â `Request`ì— í¬í•¨ëœÂ `Cookie`ê°€ í•„ìš”í•˜ë‹¤ë©´, ì´ì— ëŒ€í•œ ì„¸íŒ…ì´ ë”°ë¡œ í•„ìš”í•©ë‹ˆë‹¤.

`getServerSideProps`ì—ì„œ ì¸ìë¡œ ë°›ëŠ”Â `context.req.header.cookie`ë¥¼ í†µí•´Â `Client`ì˜Â `Request`ì— í¬í•¨ëœÂ `Cookie`ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¬¸ìì—´ í˜•íƒœì´ê¸° ë•Œë¬¸ì—, íŒŒì‹±ì´ í•„ìš”í•  ê²½ìš° íŒŒì‹± ë¡œì§ ì ìš©)

```tsx
export const getServerSideProps: GetServerSideProps = async ({ req }) => {
  const cookies = req.headers.cookie;
};
```

ìš”Â `Cookie`ë¥¼Â `AJAX`í†µì‹ ì— ì‚¬ìš©í•´,Â `Token`Â í˜¹ì€Â `Session`Â ê¸°ë°˜ìœ¼ë¡œ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
