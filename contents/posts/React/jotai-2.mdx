---
title: "ğŸ‘» Jotai ë™ì‘ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°(2)"
date: "2023-08-02"
lastmod: "2023-08-02"
category: "React"
series: "Jotai íŒŒí—¤ì¹˜ê¸°"
tags: ["jotai", "ìƒíƒœê´€ë¦¬"]
description: "ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Jotaiì˜ ë‚´ë¶€ ë™ì‘ì›ë¦¬ë¥¼ ë¶„ì„í•œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Storeì™€ ê´€ë ¨ëœ ë™ì‘ì— ëŒ€í•´ì„œ ë‹¤ë£¹ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/1dea5922-8eb2-4eec-a084-3585fdcea440"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fbyjuun.com%2Fposts%2FReact%2Fjotai-2&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

# ğŸª store

`Jotai`ì—ì„œ ì‚¬ìš©í•˜ëŠ”Â `Store`ëŠ”Â `createStore`í•¨ìˆ˜ë¥¼ í†µí•´ ìƒì„±ë©ë‹ˆë‹¤.

`createStore`ëŠ”Â `700`ì¤„ì´ ë„˜ê¸° ë•Œë¬¸ì—, ì „ì²´ êµ¬í˜„ ì½”ë“œëŠ” ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.

ì¸í„°í˜ì´ìŠ¤ë¥¼ ìœ„í•´ ë°˜í™˜ê°’ë§Œ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```tsx
return {
  get: readAtom,
  set: writeAtom,
  sub: subscribeAtom,
};
```

ê°ê°ì— ëŒ€í•´ ì‚´í´ë³´ë©´,Â `get`ì˜ ê²½ìš°Â `store`ì— ì¡´ì¬í•˜ëŠ”Â `atom`ì˜ ê°’ì„ ì½ì„ ë•Œ ì‚¬ìš©ë˜ë©°,Â `set`ì˜ ê²½ìš°Â `store`ì˜ ê°’ì„ ì“¸ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

`sub`ì˜ ê²½ìš°,Â `atom`ê³¼`listener`ë¥¼ ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ì•„Â `listeners`Â `set`ì— ì €ì¥í•©ë‹ˆë‹¤.

`jotai`ì˜ ëª¨ë“  ë™ì‘ì€Â `store`ì˜Â `get`,Â `set`,Â `sub`Â ë©”ì„œë“œë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ê²Œ ë©ë‹ˆë‹¤.

`atom`ì˜ ê°’ì„ ì—…ë°ì´íŠ¸ í•  ë•Œ ì‚¬ìš©ë˜ëŠ”Â `useSetAtom`Â í›…ì—ì„œëŠ”Â `set`Â ë©”ì„œë“œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

```tsx title="useSetAtom"
export function useSetAtom<Value, Args extends any[], Result>(
  atom: WritableAtom<Value, Args, Result>,
  options?: Options
) {
  const store = useStore(options)
  const setAtom = useCallback(
    (...args: Args) => {
      ...
      return store.set(atom, ...args)
    },
    [store, atom]
  )
  return setAtom
}

```

`atom`ì˜ ê°’ì„ ì½ì„ ë•Œ ì‚¬ìš©ë˜ëŠ”Â `useAtomValue`Â í›…ì—ì„œëŠ”Â `get`,Â `subscribe`Â ë©”ì„œë“œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

```tsx title="useAtomValue"
export function useAtomValue<Value>(atom: Atom<Value>, options?: Options) {
  const store = useStore(options);

  const [[valueFromReducer, storeFromReducer, atomFromReducer], rerender] =
    useReducer<
      ReducerWithoutAction<readonly [Value, Store, typeof atom]>,
      undefined
    >(
      (prev) => {
        const nextValue = store.get(atom);
        if (
          Object.is(prev[0], nextValue) &&
          prev[1] === store &&
          prev[2] === atom
        ) {
          return prev;
        }
        return [nextValue, store, atom];
      },
      undefined,
      () => [store.get(atom), store, atom]
    );

  let value = valueFromReducer;
  if (storeFromReducer !== store || atomFromReducer !== atom) {
    rerender();
    value = store.get(atom);
  }

  const delay = options?.delayuseEffect(() => {
    const unsub = store.sub(atom, () => {
      if (typeof delay === "number") {
        // delay rerendering to wait a promise possibly to resolve
        setTimeout(rerender, delay);
        return;
      }
      rerender();
    });
    rerender();
    return unsub;
  }, [store, atom, delay]);

  return isPromiseLike(value) ? use(value) : (value as Awaited<Value>);
}
```

`reducer`Â ë‚´ë¶€ ë¡œì§ì„ í†µí•´ ë§¤Â `rendering`Â ì‹œì ,Â `store.get(atom)`ì„ í†µí•´Â `store`ì—ì„œ í•´ë‹¹ atom`ì˜`Â `value`ë¥¼ ì½ì–´ì˜¤ë©°, í•´ë‹¹ ê°’ì„ ìƒíƒœë¡œ ì‚¬ìš©í•´, ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```tsx
const [[valueFromReducer, storeFromReducer, atomFromReducer], rerender] =
  useReducer<
    ReducerWithoutAction<readonly [Value, Store, typeof atom]>,
    undefined
  >(
    (prev) => {
      const nextValue = store.get(atom);
      if (
        Object.is(prev[0], nextValue) &&
        prev[1] === store &&
        prev[2] === atom
      ) {
        return prev;
      }
      return [nextValue, store, atom];
    },
    undefined,
    () => [store.get(atom), store, atom]
  );

let value = valueFromReducer;

return isPromiseLike(value) ? use(value) : (value as Awaited<Value>);
```

ì»´í¬ë„ŒíŠ¸ê°€Â `mount`Â ëœ ì´í›„,Â `useEffect`Â í›…ì„ í†µí•´,Â `store`ë¥¼ êµ¬ë…í•˜ëŠ” ê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
useEffect(() => {
  const unsub = store.sub(atom, () => {
    // ...rerender()
  });
  rerender();
  return unsub;
}, [store, atom, delay]);
```

ì´ë•Œ, ì¸ìë¡œÂ `rerender`Â í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´,Â `store`ì—ì„œ ë³€í™”ê°€ ë°œìƒí•˜ë©´, ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§ í•˜ê²Œ ë©ë‹ˆë‹¤.

ì¢€ ë” í™•ì‹¤í•˜ê²Œ ì‚´í´ë³´ê¸° ìœ„í•´,

`subscribeAtom`Â ë©”ì„œë“œì™€Â `listener`ë¥¼ ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„ì„ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```tsx title="jotai/src/vanilla/store.t (function : createStore)"
const subscribeAtom = (atom: AnyAtom, listener: () => void) => {
  const mounted = addAtom(atom);
  const flushed = flushPending();
  const listeners = mounted.l;
  listeners.add(listener);
  // ...
  return () => {
    listeners.delete(listener);
    delAtom(atom);
    // ...
  };
};

const flushPending = (): void | Set<AnyAtom> => {
  // ...
  mounted.l.forEach((listener) => listener());
  // ...
};
```

`subscribeAtom`Â ë©”ì„œë“œë¥¼ í†µí•´Â `listener`ë¥¼ ì €ì¥í•˜ê³ ,Â `atom`ì˜ ê°’ì´ ë³€ê²½ ë  ë•Œ ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ”Â `flushPending`Â ë©”ì„œë“œì—ì„œ í•´ë‹¹Â `listener`ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

ê·¸ë¦¼ìœ¼ë¡œ ìˆœì„œë¥¼ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

![1691162129847_á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-05 á„‹á…©á„Œá…¥á†« 12 15 21](https://github.com/BY-juun/Blog/assets/78716842/8dc9eb77-c2a7-4d2b-a4aa-a813a99c830f)

1. Component Mount
2. useEffect Execute and Subscribe Store(store.subscribeAtom)
3. atom change in store
4. publish and rerender called

ë‹¤ìŒ ë‚´ìš©ì„ ì‚´í´ë³´ê¸°ì „ì—, ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸Â `Component`,Â `Store`,Â `Provider`,Â `Atom`ì˜ ê´€ê³„ë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ìŠµë‹ˆë‹¤.

![1691162700796_á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-05 á„‹á…©á„Œá…¥á†« 12 24 51](https://github.com/BY-juun/Blog/assets/78716842/b86b26ab-8b29-4b86-8615-5a65af495610)

- ê°ê°ì˜Â `atom`ì€ í•˜ë‚˜ì˜Â `store`ì— ì†í•œë‹¤.
- `Provider`ëŠ”Â `Store`ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê»ë°ê¸°ì´ë©° ê°ê°ì˜Â `Subtree`ì— ë…ë¦½ì ì¸Â `Store`ë¥¼ ê°–ë„ë¡ ë§Œë“¤ì–´ì¤€ë‹¤.
- ì»´í¬ë„ŒíŠ¸ì™€Â `Store`ë¥¼Â `Pub-Sub`Â ê´€ê³„ì´ë©°,Â `Store`ê°€ ì—…ë°ì´íŠ¸ë˜ë©´Â `Subscribe`ë¥¼ í†µí•´ ë¦¬ë Œë”ë§ ëœë‹¤.

<br />

# ğŸ§ ìƒì„±í•œ Atomì€ ì–¸ì œ Storeì— ë“¤ì–´ê°ˆê¹Œ?

ë‹¤ìŒìœ¼ë¡œ,Â `atom`Â í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë§Œë“ Â `atom config`ê°€ ì–¸ì œÂ `store`ì— ë“¤ì–´ê°€ëŠ”ì§€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

ê²°ë¡ ë¶€í„° ë§í•˜ìë©´,Â `atom`ì€ í•´ë‹¹Â `atom`ì´Â `Store`ì—ì„œ ì²˜ìŒ ì‚¬ìš©ë˜ëŠ” ì‹œì ì—Â `Store`ì— ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.

ì¡°ê¸ˆ ë” ìì„¸íˆ ì„¤ëª…í•˜ìë©´, í•´ë‹¹Â `atom`ì´Â `Store`ì˜ íŠ¹ì • ë©”ì„œë“œì˜ ë§¤ê²Œë³€ìˆ˜ë¡œ í˜¸ì¶œë˜ëŠ” ì‹œì ì— ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.

`Store`ë‚´ë¶€ì—ì„œÂ `Atom`ì€ ë‹¤ìŒê³¼ ê°™ì€Â `WeakMap`ì„ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤.

```tsx
const atomStateMap = new WeakMap<AnyAtom, AtomState>();
```

í•´ë‹¹Â `WeakMap`ì´Â `Set`ë˜ëŠ” ì‹œì ì€Â `setAtomState`ê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ë°–ì— ì—†ìŠµë‹ˆë‹¤.

```tsx
const setAtomState = <Value>(
    atom: Atom<Value>,
    atomState: AtomState<Value>
  ): void => {
    ...
    const prevAtomState = atomStateMap.get(atom)
    atomStateMap.set(atom, atomState)
    ...
  }

```

`setAtomState`ê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ì„ ì—­ì¶”ì í•œ ê²°ê³¼ ì•„ë˜ì™€ ê°™ì€ í˜¸ì¶œ ì²´ì´ë‹ì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

1ï¸. readAtomCalled when store.get(atom) called

`const readAtom = <Value>(atom: Atom<Value>): Value => returnAtomValue(readAtomState(atom))`

2ï¸. readAtomState called

3ï¸. setAtomValueOrPromise called

4ï¸. setAtomValue called

5ï¸. setAtomState called

6ï¸. atomStateWeakMap.set(atom) called

`Store`Â ë‚´ë¶€ ë©”ì„œë“œë“¤ì˜ í˜¸ì¶œìˆœì„œë¥¼ ì—­ì¶”ì í•´ë³¸ ê²°ê³¼,Â `store`ì— ì¡´ì¬í•˜ëŠ”Â `atom`ì„ ì½ì„ ë•Œ (`when store.get(atom) called`), í•´ë‹¹Â `atom`ì´Â `store`ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ í•´ë‹¹Â `atom`ì„Â `store`ì— ë„£ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ì•„ë˜ì™€ ê°™ì´ ì»´í¬ë„ŒíŠ¸ ë°”ê¹¥ì—ì„œÂ `Store`ë¥¼ í†µí•´Â `atom`ì„ ì ‘ê·¼í•´ ê°’ì„ í™•ì¸í•´ë³´ë©´Â `Hook`Â í˜¸ì¶œ ì´ì „ì—ë„,Â `store`ì—Â `atom`ì´ ë“¤ì–´ê°€ ìˆìœ¼ë©°, í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const counterAtom = atom(1);
const doubleCountAtom = atom((get) => {
  return get(counterAtom) * 2;
});

const store = getDefaultStore();

console.log("store.get(counterAtom) : ", store.get(counterAtom)); // 1 ì¶œë ¥
console.log("store.get(doubleCountAtom) : ", store.get(doubleCountAtom)); // 2 ì¶œë ¥
function App() {
  const [count, setCount] = useAtom(counterAtom);
  const doubleCount = useAtomValue(doubleCountAtom);
  return (
    <div className="App">
      <div>
        <button onClick={() => setCount((prev) => prev - 1)}>-</button>
        <span>{count}</span>
        <button onClick={() => setCount((prev) => prev + 1)}>+</button>
      </div>
      <div>
        <span>double Count Atom : {doubleCount}</span>
      </div>
    </div>
  );
}
```

<br />

# ğŸ› ï¸Â Atomì˜ DependencyëŠ” ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ?

ë¨¼ì €,Â [ê³µì‹ë¬¸ì„œ](https://jotai.org/docs/guides/core-internals#second-version)ë¥¼ í†µí•´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

> To keep track of all the dependents, we need to add one more property to the atom's state.

Dependencyë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´, ì•„ë˜ì™€ ê°™ì´Â `dependents`ë¼ëŠ”Â `property`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```tsx
const atomState = {
  value: atom.init,
  listeners: new Set(),
  dependents: new Set(),
};
```

í•´ë‹¹Â `dependents`Â ë¼ëŠ”Â `property`ë¥¼ í†µí•´ í•´ë‹¹Â `atom`ì— ì˜ì¡´ì ì¸Â `atom`ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì•„ë˜ì™€ ê°™ì´Â `atom X`ê°€Â `atom Y`ì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ë¼ë©´,Â `atom Y`ì˜Â `dependents`Â `property`ì—ëŠ”Â `atom X`ê°€ ë“¤ì–´ê°€ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

```tsx
const atomX = atom(1);
const atomY = atom((get) => get(atomX) + 1);
```

1í¸ì—ì„œÂ `atom`ì„ ì‚´í´ë³¼ ë•Œ,Â `atom`ì˜ ê°’ì„ ì½ì„ë•ŒëŠ”Â `atom`Â ë‚´ë¶€ì—ì„œÂ `read`ë¼ëŠ”Â `property`ë¥¼ í†µí•´Â `store`ì— ì¡´ì¬í•˜ëŠ”Â `atom`ì˜Â `value`ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```tsx
export function atom<Value, Args extends unknown[], Result>(
  read: Value | Read<Value, SetAtom<Args, Result>>,
  write?: Write<Args, Result>
) {
	...
  if (typeof read === 'function') {
    config.read = read as Read<Value, SetAtom<Args, Result>>
  } else {
		...
    config.read = (get) => get(config)
		...
  }
  return config
}

```

`atom`ì˜ ì²« ë²ˆì§¸ ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ëŠ”Â `read`ì˜ íƒ€ì…ì´ í•¨ìˆ˜ì¸ì§€,Â `atom`Â `config`ì¸ì§€ì— ë”°ë¼,Â `atom`ì´ ë°˜í™˜í•˜ëŠ”Â `read`ê°€ ë‹¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤.

1. readì˜ íƒ€ì…ì´ í•¨ìˆ˜ì¸ ê²½ìš°(ë‹¤ë¥¸ atomì— ì˜ì¡´ì ì¸ atom) : ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ëŠ” read ë°˜í™˜
2. readì˜ íƒ€ì…ì´ í•¨ìˆ˜ê°€ ì•„ë‹Œ ê²½ìš°(ë‹¤ë¥¸ atomì— ì˜ì¡´ì ì´ì§€ ì•Šì€ atom) : ìê¸° ìì‹ (atom config)ì„ ë§¤ê²Œë³€ìˆ˜ë¡œ ë„£ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜

1í¸ì—ì„œ ì‚´í´ë³´ì•˜ë“¯, ë§¤Â `rendering`Â ë§ˆë‹¤,Â `atom`ì˜Â `read`ê°€ ì‹¤í–‰ë˜ì–´Â `store`ì—ì„œ í•´ë‹¹Â `atom`ì˜ ê°’ì„ ì½ì–´ì˜¤ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ë‹¤ìŒìœ¼ë¡œëŠ”Â `store`ì—ì„œ í•´ë‹¹Â `atom`ì˜ ê°’ì„ ì½ëŠ” ë¶€ë¶„ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
const readAtom = (atom) => {
  const atomState = getAtomState(atom);
  const get = (a) => {
    if (a === atom) {
      return atomState.value;
    }
    const aState = getAtomState(a);
    aState.dependents.add(atom); // XXX add onlyreturn
    readAtom(a); // XXX no caching
  };
  const value = atom.read(get);
  atomState.value = value;
  return value;
};
```

`get`í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ë©´ ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ëŠ”Â `a`ê°€ ìê¸°ìì‹ ì´ë¼ë©´(ì•ì„œ ì‚´í´ë³¸ 2ë²ˆ ì¼€ì´ìŠ¤ â†’Â `if (a === atom)`) í•´ë‹¹Â `atom`ì˜Â `value`ë¥¼ ë°˜í™˜í•˜ê³ , ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ëŠ” aê°€ ìê¸°ìì‹ ì´ ì•„ë‹ ê²½ìš°(ì•ì„œ ì‚´í´ë³¸ 1ë²ˆ ì¼€ì´ìŠ¤), ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ëŠ”Â `a`ì˜ ê°’ì„Â `store`ì—ì„œ ê°€ì§€ê³  ì˜¤ê²Œ ë©ë‹ˆë‹¤(`const aState = getAtomState(a)`).

ê·¸ ì´í›„, í•´ë‹¹Â `atom`ì˜Â `dependents`Â `property`ì—Â `a`ë¥¼ ì¶”ê°€í•˜ê³ (`aState.dependents.add(atom)`), ì¬ê·€ì ìœ¼ë¡œÂ `readAtom`ì„ í˜¸ì¶œí•´ì„œ ë‹¤ë¥¸Â `atom`ì— ì˜ì¡´ì ì¸Â `atom`ì¸ì§€ ì—¬ë¶€ì— ë”°ë¼Â `read`Â ë¡œì§ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.

`atom`ì˜ ê°’ì´ ë°”ë€” ë•ŒëŠ”,Â `dependents`Â `property`ì— ì €ì¥ë˜ì–´ ìˆëŠ” ëª¨ë“ Â `atom`ì—ê²ŒÂ `notify`ë¥¼ í•˜ê²Œ ë˜ê³ , ê°ê°ì˜ atomë“¤ì€ listener í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.(ìœ„ì—ì„œ ì‚´í´ë³¸Â `rerender`)

```tsx
const notify = (atom) => {
  const atomState = getAtomState(atom);
  atomState.dependents.forEach((d) => {
    if (d !== atom) notify(d);
  });
  atomState.listeners.forEach((l) => l());
};

// writeAtom calls atom.write with the necessary params and triggers notify function
const writeAtom = (atom, value) => {
  const atomState = getAtomState(atom);

  // 'a' is some atom from atomStateMap
  const get = (a) => {
    const aState = getAtomState(a);
    return aState.value;
  };

  // if 'a' is the same as atom, update the value, notify that atom and return else calls writeAtom for 'a' (recursively)
  const set = (a, v) => {
    if (a === atom) {
      atomState.value = v;
      notify(atom);
      return;
    }
    writeAtom(a, v);
  };

  atom.write(get, set, value);
};
```

ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬ê°€ ë©ë‹ˆë‹¤.

- ê°ê°ì˜Â `atom`ì€Â `dependents`Â propertyë¥¼ í†µí•´ ìì‹ ì—ê²Œ ì˜ì¡´ì ì¸ atomë“¤ì„ ì €ì¥í•œë‹¤.
- atomì„ ì½ì„ ë•Œ(readê°€ ì‹¤í–‰ë˜ì–´ storeì—ì„œ í•´ë‹¹ atomì˜ ê°’ì„ ì½ì„ ë•Œ), í•´ë‹¹Â `atom`ì´ ë‹¤ë¥¸Â `atom`ì— ì˜ì¡´ì ì¸ atom`ì´ë¼ë©´`, ì˜ì¡´í•˜ëŠ”Â `atom`ì˜Â `dependents`ì— ì¶”ê°€í•˜ê³  ì¬ê·€ì ìœ¼ë¡œÂ `atom`ì˜ ê°’ì„ ì½ëŠ”ë‹¤
- `atom`ì— ê°’ì„ ì“¸ ë•Œ, í•´ë‹¹Â `atom`ì„ ì˜ì¡´í•˜ëŠ”Â `atom`ë“¤ì—ê²ŒÂ `notify`ë¥¼ í•´ì£¼ì–´ ê°ê°ì˜Â `atom`ë“¤ì´ ìƒˆë¡­ê²Œ ì—…ë°ì´íŠ¸ëœ ê°’ì„ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
