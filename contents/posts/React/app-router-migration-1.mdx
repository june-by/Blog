---
title: "ë¸”ë¡œê·¸ Pages Router â†’ App Router ì „í™˜ê¸° 1í¸ [NextJS]"
date: "2023-11-07"
lastmod: "2023-11-07"
category: "React"
tags: ["nextjs", "rsc"]
series: "Blog ê°œë°œì¼ì§€"
description: "NextJS v12ì˜ Page Router ë°©ì‹ìœ¼ë¡œ ê°œë°œëœ ê°œì¸ë¸”ë¡œê·¸ë¥¼ NextJS v13(14)ì˜ AppRouterë¡œ ì „í™˜í•˜ë©´ì„œ ìˆì—ˆë˜ ê³¼ì •ì— ëŒ€í•´ ì •ë¦¬í•œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/883000a0-6c6f-4c2d-8a99-225afa10d0c4"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fbyjuun.com%2Fposts%2FReact%2Fapp-router-migration-1&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

# âš™ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•œ ì´ìœ 

`React Server Component` ê°€ ë“±ì¥í•œì§€ëŠ” ì•½ 2ë…„, `App router`ê°€ ì•ˆì •í™”ëœ NextJS 13.4ë²„ì „ì´ ë“±ì¥í•œì§€ëŠ” ì•½ 6ê°œì›”ì˜ ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.

ì˜¬í•´ TODO ë¦¬ìŠ¤íŠ¸ ì¤‘ì—ëŠ” `RSC(React Server Component)`ì˜ ë™ì‘ì›ë¦¬ ìŠ¤í„°ë””ì™€ ë¸”ë¡œê·¸ `App Router` ì „í™˜ì´ ìˆì—ˆëŠ”ë°ìš”.

`App Router` ë°©ì‹ì—ì„œëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ê¸°ë³¸ì ìœ¼ë¡œ `Server Component`ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, `App Router` ì „í™˜ì„ ì§„í–‰í•˜ê²Œ ëœë‹¤ë©´, ë™ì‹œì— `RSC`ë¥¼ ê³µë¶€í•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ë  ìˆ˜ ìˆë‹¤ ìƒê°í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ë¡œ `Pages Router` êµ¬ì¡°ì—ì„œ í¬ê²Œ ë¶ˆí¸í•œ ì ì„ ëŠë¼ì§€ ëª»í•´ ê³„ì†í•´ì„œ ë¯¸ë£¨ë‹¤, ìµœê·¼ì— `App Router`, `RSC` ê´€ë ¨ ì—¬ëŸ¬ ì•„í‹°í´ë“¤ì„ ë§ì´ ì ‘í•˜ê²Œ ë˜ì–´ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

<br />

# ğŸ› ï¸ Server Component ê°„ë‹¨í•˜ê²Œ ì‚´í´ë³´ê¸°

## RSC(React Server Component)

ê¸°ì¡´ `React`ì—ì„œëŠ” ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ì— ë“¤ì–´ê°€ì„œ ë²ˆë“¤ë§ëœ íŒŒì¼(ex, bundle.js)ì„ ë‹¤ìš´ë¡œë“œ ë°›ì€ í›„, í•´ë‹¹ íŒŒì¼ì˜ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ë©´ íŒŒì¼ì„ ì‹¤í–‰í•˜ê³  í™”ë©´ì„ ê·¸ë ¸ìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ì— ì²˜ìŒ ë“¤ì–´ê°€ ì„œë²„ë¡œ ë¶€í„° ë°›ê²Œë˜ëŠ” html íŒŒì¼ì€ ë¹„ì–´ìˆì—ˆìŠµë‹ˆë‹¤.(ì˜¤ì§ `<div id=â€rootâ€></div>` ë§Œ ì¡´ì¬)

ì½”ë“œìŠ¤í”Œë¦¬íŒ…, íŠ¸ë¦¬ì‰ì´í‚¹ë“±ì˜ ìµœì í™” ê³¼ì •ì„ í†µí•´ ì´ˆê¸° ë¡œë“œ ì†ë„ë¥¼ ì¡°ê¸ˆ ë” ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆì§€ë§Œ, ì—¬ì „íˆ ëŠë¦¬ë©° jsë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì„ë•Œê¹Œì§€ ì‚¬ìš©ìëŠ” ë¹ˆ í™”ë©´ë§Œì„ ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

`RSC(React Server Component)`ëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¼ëŠ” ì´ë¦„ë‹µê²Œ í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ê°€ ì•„ë‹Œ ì„œë²„ì—ì„œ ë™ì‘í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

ì„œë²„ì—ì„œ ë™ì‘í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì´ê¸° ë•Œë¬¸ì—, ì‚¬ìš©ìëŠ” í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ ë²ˆë“¤íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì‹¤í–‰í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì¥ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

RSCê°€ ë Œë”ë§ë˜ëŠ” ì ˆì°¨ë¥¼ ê°„ë‹¨íˆ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. (Reference â†’ <a href="https://www.plasmic.app/blog/how-react-server-components-work">how-react-server-components-work</a>)

1. ì„œë²„ì—ì„œ ìš”ì²­ì„ ë°›ì•„, ì–´ë–¤ `Component`, ì–´ë–¤ `Props`ë¥¼ ì ìš©í• ì§€ ê²°ì •í•œë‹¤.
2. ì„œë²„ê°€ `Root Component`ë¥¼ `JSON`ìœ¼ë¡œ ì§ë ¬í™”í•œë‹¤. ì´ë•Œ, `Client Component`ë¥¼ ë§Œë‚˜ë©´ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì§ë ¬í™”í•˜ì§€ ì•Šê³ , `placeholder` í•´ë†“ëŠ”ë‹¤.
3. ì„œë²„ì—ì„œ ì´ˆê¸° ë£¨íŠ¸ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¥¼ ê¸°ë³¸ `HTML` íƒœê·¸ì™€ `Client Componet placeholders`ì˜ íŠ¸ë¦¬ë¡œ ë Œë”ë§í•œ í›„ ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡í•œë‹¤.
4. ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì§ë ¬í™”ëœ íŠ¸ë¦¬ë¥¼ ì—­ì§ë ¬í™”í•˜ê³ , `Clinet Component placeholders`ë¥¼ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ `JavaScript Bundle` íŒŒì¼ì„ ì´ìš©í•´ ì‹¤ì œ `Client Component`ë¡œ êµì²´í•œë‹¤.
5. ìµœì¢… ê²°ê³¼ë¬¼ì„ ë Œë”ë§í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤€ë‹¤.

## NextJSì—ì„œì˜ Server Component Rendering

NextJSì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì ˆì°¨ë¥¼ ê±¸ì³ ì‚¬ìš©ìì—ê²Œ interactiveí•œ í˜ì´ì§€ë¥¼ ì œê³µí•©ë‹ˆë‹¤. â†’ <a href="https://nextjs.org/docs/app/building-your-application/rendering/server-components">
https://nextjs.org/docs/app/building-your-application/rendering/server-components</a>

1. (on the server) `React`ê°€ `Server Component`ë¥¼ ë Œë”ë§í•´ `RSC Payload`ë¥¼ ë§Œë“ ë‹¤.
2. (on the server) ë§Œë“¤ì–´ì§„ `RSC Payload`ì™€ `Client Component JavaScript`ë¥¼ ì´ìš©í•´ `HTML`ì„ ë§Œë“ ë‹¤.
3. (on the client) `HTML`ì„ ì´ìš©í•´ `non-interactive`í•œ í™”ë©´ì„ ë¨¼ì € ë³´ê²Œ ëœë‹¤.
4. (on the client) `stream`ì„ í†µí•´ ë°›ì€ `RSC Payload`ë¥¼ ì´ìš©í•´ `Client`, `Server Component Tree`ë¥¼ ì¬ì¡°ì •í•˜ê³ , `DOM`ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
5. (on the client) `Hydration`ì„ í†µí•´ `interactive`í•˜ê²Œ ë§Œë“ ë‹¤.

ì´ ê³¼ì •ì—ì„œ `Full Page`ë¥¼ ê°€ì ¸ì˜¤ëŠ”ê²Œ ì•„ë‹Œ `Navigation`ì„ ë³€ê²½í•˜ëŠ” ê²½ìš°ë¼ë©´, `Client Component`ëŠ” ì„œë²„ì—ì„œ ë Œë”ë§ë˜ì–´ `HTML`ì„ ë§Œë“¤ì§€ ì•Šê³ , ì˜¤ì§ `Client`ì—ì„œë§Œ ë Œë”ë§ ë©ë‹ˆë‹¤. (<a href="https://nextjs.org/docs/app/building-your-application/rendering/server-components">https://nextjs.org/docs/app/building-your-application/rendering/server-components</a>)

â†’ Client Component JS Bundleì„ ë‹¤ìš´ë¡œë“œë°›ê³  íŒŒì‹±í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

## ê¸°ì¡´ SSR (With Client-Component)

ê¸°ì¡´ `SSR`ì€ <u>Pageë‹¨ìœ„ë¡œ ë Œë”ë§ ë°©ì‹ì„ ê²°ì •</u>í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

- ê¸°ì¡´ NextJSì˜ ê²½ìš°, getServerSidePropsë¥¼ ì‚¬ìš©í•  ê²½ìš° SSR
- ê¸°ì¡´ NextJSì˜ ê²½ìš°, getStaticProps ì‚¬ìš©í•  ê²½ìš° SSG

ì˜ˆë¥¼ ë“¤ì–´, `SSG`ì„ í•˜ëŠ” Pageë¼ê³  ê°€ì •í•œë‹¤ë©´, í•´ë‹¹ `Page`ì—ì„œ ë¦¬ì–¼íƒ€ì„ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ì˜ì—­ì´ ìˆë‹¤ë©´, í•´ë‹¹ ì˜ì—­ì€ ì„œë²„ì—ì„œ ë Œë”ë§ì„ í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

ë°˜ëŒ€ë¡œ, `SSR`ì„ í•˜ëŠ” Pageì—ì„œ íŠ¹ì • ì˜ì—­ì´ `Static`í•œ ë°ì´í„°ë¥¼ ë‹¤ë£¬ë‹¤ê³  í•˜ë”ë¼ë„, í•´ë‹¹ ì˜ì—­ì„ `Static`í•˜ê²Œ ë Œë”ë§ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ê¸°ì¡´ `SSR`ì€ ì‹¤ì œ <u>ëª¨ë“  ì½”ë“œê°€ JavaScript Bundle íŒŒì¼ì— í¬í•¨</u>ë©ë‹ˆë‹¤. ì„œë²„ì—ì„œ ë Œë”ë§ë˜ì–´ `HTML`ë¡œ ë³€í™˜ëœ í›„ í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ì§€ì§€ë§Œ, ëª¨ë“  ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ” JavaScript Bundle íŒŒì¼ì„ ë°›ì•„ì˜¨ í›„ `Hydration` ê³¼ì •ì„ ê±°ì³ì•¼ í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ì‚¬ìš©ìê°€ ë¹ˆ í™”ë©´ì´ ì•„ë‹Œ ì´ˆê¸° í™”ë©´ì„ ë³´ëŠ” ì†ë„ë¥¼ ë¹ ë¥´ì§€ë§Œ, í˜ì´ì§€ì™€ ìƒí˜¸ ì‘ìš© í•  ìˆ˜ ìˆëŠ” `TTI(Time To Interactive)`ëŠ” ì—¬ì „íˆ ëŠë¦½ë‹ˆë‹¤.

ê¸°ì¡´ `SSR`ì— `RSC`ë¥¼ í•©ì¹ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- RSCëŠ” ì„œë²„ì—ì„œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, <u>JavaScript Bundle íŒŒì¼ì— í¬í•¨ì‹œí‚¤ì§€ ì•Šì•„ íŒŒì¼ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.</u>
- ëª¨ë“  JavaScript BundleíŒŒì¼ì„ ë°›ì•„, `Hydration`ì„ í•˜ëŠ”ê²Œ ì•„ë‹Œ `Stream` í˜•íƒœë¡œ ë°›ì€ `RSC Payload`ë¥¼ í†µí•´ `Client-Component payload`ë¡œ ë§ˆí‚¹ë˜ì–´ ìˆëŠ” ë¶€ë¶„ë§Œ JavaScript BundleíŒŒì¼ì„ ì´ìš©í•´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë Œë”ë§í•˜ê¸° ë•Œë¬¸ì—, í›¨ì”¬ ë¹ ë¥¸ `TTI` ì‹œê°„ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.

ì´ë²ˆì— ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•œ `NextJS`ì˜ `App Router` ë°©ì‹ì€ `RSC`í˜•íƒœë¥¼ ì œê³µí•˜ëŠ” `NextJS`ì˜ ìƒˆë¡œìš´ ë°©ì‹ì…ë‹ˆë‹¤. (RSC ì œê³µ ì´ì™¸ì—ë„, ê¸°ì¡´ì˜ file system based routerê°€ ë°œì „ëœ í˜•íƒœ)

<br/ >

# Trouble Shooting, Feature

ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê³µì‹ë¬¸ì„œë¥¼ ë³´ê³  ì§„í–‰í–ˆê¸° ë•Œë¬¸ì—, ìì„¸í•œ ë‚´ìš©ì€ [ê³µì‹ë¬¸ì„œ](https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration#migrating-from-pages-to-app)ë¥¼ ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤

## Render Props ì—ëŸ¬

ê¸°ì¡´ì—ëŠ” ì•„ë˜ ì½”ë“œì²˜ëŸ¼ Routingì´ ë³€í™”í•  ë•Œ, í™”ë©´ì— ë³´ì—¬ì•¼ í•˜ëŠ” `FallBack Component`ë¥¼ ê·¸ë ¤ì•¼ë˜ëŠ” ìƒí™©ì— `Render Prop íŒ¨í„´`ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx title="app.tsx"
function MyApp({ Component, pageProps }: AppProps) {
  return (
    <WithRouteChange routeChangeFallback={(url) => <PageSkeleton url={url} />}>
      <CommonSEO />
      <Component {...pageProps} />
      <Modals />
      <MyToastContainer />
      <ReactQueryDevtools initialIsOpen={false} />
    </WithRouteChange>
  );
}
```

```tsx title="Pathì— ë”°ë¼ Skeleton ë Œë”ë§"
const PageSkeleton = ({ url }: Props) => {
  const mainPath = getMainPathFromUrl(url);
  return (
    <>
      <SwitchCase
        value={mainPath}
        caseBy={{
          post: <PostPageSkeleton />,
          posts: <PostsPageSkeleton />,
          needed: null,
        }}
      />
    </>
  );
};
```

`PageSkeleton` ì»´í¬ë„ŒíŠ¸ `url`ì„ `props`ë¡œ ë°›ì•„, í™”ë©´ì— í‘œì‹œí•  `Skeleton`ì„ ë Œë”ë§í•©ë‹ˆë‹¤.

`RSC`ëŠ” ì§ë ¬í™”ë˜ì–´ ë¸Œë¼ìš°ì €ì— ì „ë‹¬ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ì§ë ¬í™”ê°€ ë¶ˆê°€ëŠ¥í•œ í•¨ìˆ˜ëŠ” `props`ë¡œ ì „ë‹¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (`ServerComponent` â†’ `ClientComponent` ê²½ìš°ì—ë§Œ)  
ê·¸ë¦¬ê³  ìœ„ì— ì½”ë“œì²˜ëŸ¼ ì „ë‹¬í•˜ê²Œ ë˜ì—ˆì„ ë•Œ, ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤.

<img src="https://github.com/BY-juun/Blog/assets/78716842/ff584c88-b032-409b-889b-602089027677" />

ì œê°€ ìƒê°í–ˆì„ ë•Œ, ìœ„ ì—ëŸ¬ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ ì´ 3ê°€ì§€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

1. Client ComponentëŠ” Server Componentë¡œ ë³€ê²½
2. propsë¡œ ë„˜ê¸°ëŠ” í•¨ìˆ˜ì— â€œuse serverâ€ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´, server actionìœ¼ë¡œ ë°”ê¾¸ê¸°
3. í•¨ìˆ˜ë¥¼ propsë¡œ ë„˜ê¸°ì§€ ì•Šë„ë¡ ì½”ë“œ, êµ¬ì¡° ìˆ˜ì •

(ì°¸ê³  Reference â†’ <a href="https://medium.com/@warren_74490/there-and-back-again-next-13-and-render-props-b1a11d4d1d24">https://medium.com/@warren_74490/there-and-back-again-next-13-and-render-props-b1a11d4d1d24</a>)

í•˜ì§€ë§Œ, ìœ„ `Skeleton` ì½”ë“œëŠ” routingì— ëŒ€í•œ loading stateë¥¼ ìœ„í•œ ì½”ë“œì˜€ê³ , App Routerì—ì„œëŠ” ê° Routing ë””ë ‰í† ë¦¬ì— `loading.tsx` íŒŒì¼ì„ ë§Œë“¤ì–´, ëŒ€ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ, ìœ„ ì½”ë“œë¥¼ ì‚­ì œí•˜ê³  ê° Routing ë””ë ‰í† ë¦¬ì˜ `loading.tsx` íŒŒì¼ë¡œ ëŒ€ì²´í•˜ì˜€ìŠµë‹ˆë‹¤.

<br />

# Compound Component íŒ¨í„´ ì‚¬ìš© ë¶ˆê°€

ê¸°ì¡´ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ `Compound Component` íŒ¨í„´ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx title="pages/post/index.tsx"
const PostPage = () => {
  // ...

  return (
    <>
      <CommonSEO
        title={PostData.title}
        description={PostData.content.substring(0, 100)}
        ogTitle={PostData.title}
        ogDescription={PostData.content.substring(0, 100)}
        ogImage={getOgImage(PostData.thumbNailUrl, String(PostData.category))}
        ogUrl={`https://byjuun.com/post/${id}`}
      />
      <ScrollIndicator />
      <Post Post={PostData}>
        <Post.AdminButtons />
        <Post.Title />
        <div className={styles.div1}>
          <Post.Date />
          <Post.Category />
        </div>
        <Post.Tags />
        <Post.ViewCount />
        <div className={styles.contentSection}>
          <div className={styles.content}>
            <Post.SeriesInfo />
            <Post.Content />
          </div>
          <Post.TableOfContents />
        </div>
        <Post.RoutePostButtons />
        <Post.Comments />
      </Post>
      <ScrollToTopButton />
    </>
  );
};
```

ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰ê³¼ì •ì—ì„œ í•´ë‹¹ `Post Page`ë¥¼ `Server Component`ë¡œ ì˜®ê¸°ê²Œ ë˜ë©´, ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤.

<img src="https://github.com/BY-juun/Blog/assets/78716842/bd1bd6b5-3991-4627-a0c9-3ea4451f5af6" />

ê´€ë ¨ Referenceë¥¼ ì°¾ì•„ë³´ì•˜ì§€ë§Œ ì—†ì—ˆìŠµë‹ˆë‹¤.

ì¶”ì¸¡í•˜ê¸°ë¡œëŠ” `Server Component`ì—ì„œ `Compound Component íŒ¨í„´`ì„ ì‚¬ìš©í•˜ê²Œ ë  ê²½ìš°, ì§ë ¬í™” ê³¼ì •ì—ì„œ í•„ìš”í•œ `Component Type`ì„ íŒŒì•…í•  ìˆ˜ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë¥¼ `Client Component`ë¡œ ë°”ê¿”ë„ í•´ê²°ì´ ë˜ì§€ë§Œ, `SSG` í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•˜ëŠ” `Root Component` ì˜€ê³ , `User Interaction`ì´ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì—, `Compound Component íŒ¨í„´`ì„ ë²„ë¦¬ê³  ê°ê°ì˜ Componentë¥¼ ë”°ë¡œ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•˜ëŠ” ì•„ë˜ ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í•´ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

```tsx title="app/post/page.tsx"
const PostPage = async ({ params }: Props) => {
  // ...
  return (
    <WithPostPublicValidation isPublic={isPublic}>
      <ScrollIndicator />
      <WithAdminValidation>
        <PostAdminButtons id={id} />
      </WithAdminValidation>
      <PostTitle title={title} />
      <PostTags Tags={Tags} />
      <PostViewCount id={id} />
      <div className={styles.div1}>
        <PostDate date={createdAt} />
        <PostCategory category={category} />
      </div>
      <div className={styles.contentSection}>
        <div className={styles.content}>
          <PostSeriesInfo
            seriesPosts={seriesPosts}
            seriesTitle={seriesTitle}
            SeriesId={SeriesId}
            id={id}
          />
          <PostContent category={category} content={content} />
        </div>
        <PostTableOfContents title={title} />
      </div>
      <RoutePostButtons prevPost={prevPost} nextPost={nextPost} />
      <PostComments />
      <ScrollToTopButton />
    </WithPostPublicValidation>
  );
};
```

<br />

# Good Bye Axios

`App router`ì—ì„œëŠ” `fetch API`ì˜ ì˜µì…˜ì„ ì´ìš©í•´ ë Œë”ë§ ë°©ì‹ì„ ê²°ì •í•˜ê²Œ ë©ë‹ˆë‹¤. <a href="https://nextjs.org/docs/app/api-reference/functions/fetch">(ê³µì‹ë¬¸ì„œ)</a>

ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ `Axios`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìºì‹±ì„ ìœ„í•œ ì„¸íŒ…ì´ ì¶”ê°€ë¡œ í•„ìš”í–ˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ `Axios`ë¥¼ ê±·ì–´ë‚´ê³  `fetch API`ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ì— `axios instance`ë¥¼ í•œë²ˆ ê°ì‹¼ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì—, í•´ë‹¹ í•¨ìˆ˜ì˜ êµ¬í˜„ë§Œ ë°”ê¾¸ì—ˆìŠµë‹ˆë‹¤.

```ts title="AS-IS"
interface RequestParams {
  method: "get" | "post" | "patch" | "delete";
  url: string;
  body?: any;
  onError?: (err: any) => any;
}

const request = async <T>({
  method,
  url,
  body,
  onError,
}: RequestParams): Promise<T> => {
  try {
    const { data } = await customAxios[method](url, body);
    return data;
  } catch (err: any) {
    const errorMessage = onError ? onError(err) : err?.response?.data;
    throw new Error(errorMessage || MESSAGE.NETWORK_ERROR);
  }
};
```

```ts title="TO-BE"
interface RequestParams {
  method: "get" | "post" | "patch" | "delete";
  url: string;
  body?: any;
  options?: Parameters<typeof fetch>[1];
}

const request = async <T>({
  method,
  url,
  body,
  options,
}: RequestParams): Promise<T> => {
  if (process.env.NODE_ENV === "development") {
    process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = "0";
  }
  try {
    const res = await fetch(`${ServerURL}${url}`, {
      method,
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(body),
      credentials: "include",
      ...options,
    });

    const data = await convertResponse<T | string>(res);

    if (res.ok) {
      return data as T;
    } else {
      throw new Error(data as string);
    }
  } catch (err: any) {
    console.error("error : ", err);
    throw new Error(err?.message || MESSAGE.NETWORK_ERROR);
  }
};

export default request;

async function convertResponse<T>(res: Response): Promise<T> {
  const isJSONResponse =
    res.headers.get("content-type")?.indexOf("application/json") !== -1;

  if (isJSONResponse) {
    return await res.json();
  } else {
    return (await res.text()) as unknown as T;
  }
}
```

<br />

# Server Componentì—ì„œ Fetchë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ

`App Router`ê¸°ë°˜ì—ì„œëŠ” fetch apiì˜ `cache option`ì„ í†µí•´ ë Œë”ë§ ë°©ì‹ì„ ê²°ì •í•˜ê²Œ ë©ë‹ˆë‹¤.  
í•˜ì§€ë§Œ, <u>ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” API Callì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ í•˜ê²Œ ë  ê²½ìš°</u>, `cache option`ì„ ì§€ì •í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

`Notion`ì—ì„œ ì œê³µí•˜ëŠ” APIë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ `SSG`ë¥¼ í•˜ëŠ” `about` í˜ì´ì§€ê°€ í•´ë‹¹ ì¼€ì´ìŠ¤ì— í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx title="pages/about/index.tsx"
const AboutPage = ({ recordMap }: Props) => {
  return (
    <>
      <CommonSEO title="About | Byjuun.com" description="ğŸ“„ ê°œì¸ì´ë ¥ì„œ" />
      <PageTitle title="ğŸ“„ About" description="ğŸ§‘â€ğŸ’» ê°œì¸ì´ë ¥ì„œì…ë‹ˆë‹¤." />
      <ScrollToTopButton />
      <NotionRenderer recordMap={recordMap} />
    </>
  );
};

export async function getStaticProps() {
  const notion = new NotionAPI();
  const NOTION_PAGE_ID = "on-Website-8f7d18bbf99644dbac7129dfd252e373?pvs=4";
  const recordMap = await notion.getPage(NOTION_PAGE_ID);
  return {
    props: {
      recordMap,
    },
  };
}
```

Notion ì„œë²„ë¡œ API Callì„ í•˜ëŠ” ì½”ë“œê°€ `notion-client` ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ë¶€ì— ìˆì—ˆê¸° ë•Œë¬¸ì—, `cache option`ì„ ì„¤ì •í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

ì´ ìƒíƒœ ê·¸ëŒ€ë¡œ `App Router`ê¸°ë°˜ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•  ê²½ìš°, `SSG`ê°€ ì•„ë‹Œ `SSR`í˜•íƒœë¡œ ë Œë”ë§ë˜ê²Œ ë©ë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ë‚´ë¶€ì ìœ¼ë¡œ `notion-client` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë‚´ë¶€ apië¥¼ ë”°ë¡œ ë§Œë“¤ê³ , about í˜ì´ì§€ì—ì„œëŠ” í•´ë‹¹ apië¥¼ fetchë¥¼ í†µí•´ callí•˜ê²Œ ë§Œë“¤ì–´, `Static Generation`ì´ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```tsx title="apps/about/page.tsx"
const AboutPage = async () => {
  const recordMap = await getNotionRecordMap();
  if (!recordMap) {
    return <NotFoundPageIndicator text="ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." />;
  }
  return (
    <>
      <PageTitle title="ğŸ“„ About" description="ğŸ§‘â€ğŸ’» ê°œì¸ì´ë ¥ì„œì…ë‹ˆë‹¤." />
      <ScrollToTopButton />
      <NotionPage recordMap={recordMap} />
    </>
  );
};

async function getNotionRecordMap() {
  try {
    const res = await fetch("/about/api", {
      cache: "force-cache",
    });
    const recordMap: notion.ExtendedRecordMap = await res.json();
    return recordMap;
  } catch (err) {
    return null;
  }
}
```

```ts title="about/api/route.ts"
export async function GET() {
  const notion = new NotionAPI();
  const recordMap = await notion.getPage(NOTION_PAGE_ID);
  return NextResponse.json(recordMap);
}
```

<br />

# Server Componentì™€ Client ë¡œì§ ë¶„ë¦¬

ì•„ë˜ì™€ ê°™ì´ <u>User Interactionì„ ìœ„í•œ í•¸ë“¤ëŸ¬ê°€ ì—†ëŠ” ê²½ìš°</u>ì—ëŠ” ë²ˆë“¤íŒŒì¼ì˜ í¬ê¸°ë¥¼ ì¤„ì´ê¸° ìœ„í•´, `HOC` íŒ¨í„´ì„ ì‚¬ìš©í•´ `Client` ë¡œì§ì„ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶€í„° ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.

AS-IS

```tsx
const PostContent = () => {
  const { category, content } = usePostContext();
  useHighLightCodeBlock(category);
  return (
    <>
      <article
        className={classnames("Code", styles.PostContent)}
        dangerouslySetInnerHTML={{ __html: content }}
      />
    </>
  );
};
```

TO-BE

```tsx title="post/HighLightCodeBlock.tsx"
"use client";
const HighLightCodeBlock = ({
  category,
  children,
}: PropsWithChildren<Pick<PostType, "category">>) => {
  useHighLightCodeBlock(category);
  return <>{children}</>;
};
```

```tsx title="post/PostContent.tsx"
// ì•„ë˜ëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸
const PostContent = ({ content }: Pick<PostType, "content">) => {
  return (
    <article
      className={classnames("Code", styles.PostContent)}
      dangerouslySetInnerHTML={{ __html: content }}
    />
  );
};
```

```tsx title="post/postContentWrap.tsx"
const PostContentWrap = ({
  category,
  content,
}: Pick<PostType, "category" | "content">) => {
  return (
    <HighLightCodeBlock category={category}>
      <PostContent content={content} />
    </HighLightCodeBlock>
  );
};
```

`HOC` íŒ¨í„´ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” `React Tree` êµ¬ì¡°ì—ì„œ `Client Component`ê°€ ìì‹ìœ¼ë¡œ `Server Component`ë¥¼ ê°€ì§€ê¸° ìœ„í•´ì„œëŠ” <u>children propsë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë°–ì— ì—†ê¸° ë•Œë¬¸</u>ì…ë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤. â†’ <a href="https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns#supported-pattern-passing-server-components-to-client-components-as-props">https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns#supported-pattern-passing-server-components-to-client-components-as-props</a>

ìš”ì•½í•˜ë©´, ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- `client-component` ì…ì¥ì—ì„œëŠ” `children`ìœ¼ë¡œ ë¬´ì—‡ì´ ì˜¬ì§€ ì•Œ ìˆ˜ ì—†ê³  ì•Œ í•„ìš”ë„ ì—†ìœ¼ë©°, ì˜¤ì§ íŠ¹ì • ìë¦¬ì— `children`ì„ ë‘ë©´ ëœë‹¤ëŠ”ê²ƒì— ëŒ€í•œ ì±…ì„ë§Œ ìˆë‹¤.
- ê³µí†µ ì¡°ìƒ(ìœ„ì—ì„œëŠ” `PostContetWrap`)ì´ ìˆê¸° ë•Œë¬¸ì—, `client-component(HighLightCodeBlock)`ê³¼ `server-component(PostContent)`ê°€ ë”°ë¡œ ë Œë”ë§ ë˜ë©°, **server-componentëŠ” serverì—ì„œ ë¨¼ì € ë Œë”ë§**ëœë‹¤.

í¬ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ì–´ì ¸ 2í¸ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì˜¬ë¦¬ê² ìŠµë‹ˆë‹¤.

2í¸ì—ì„œëŠ” Trouble Shooting, Featureì˜ ë‚¨ì€ ë¶€ë¶„(SSG, Cache Revalidation, HOC ë“±)ê³¼ App Routerë¡œ ì „í™˜í•˜ë©° ì¢‹ì•˜ë˜ì ê³¼ ì•„ì‰¬ì› ë˜ì ì— ëŒ€í•´ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.
