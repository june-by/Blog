---
title: "ì„œë²„ ìƒíƒœ ê´€ë¦¬ with RTK Query"
date: "2022-12-08"
lastmod: "2022-12-08"
category: "React"
tags: ["redux", "rtk"]
description: "Redux ToolKit Queryë¥¼ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ë©° ì •ë¦¬í–ˆë˜ ë‚´ìš©ì— ëŒ€í•´ ë‹¤ë£¬ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
thumbNail: "https://github.com/BY-juun/Blog/assets/78716842/d712bc01-f9d2-481b-b1b7-bb77a813636c"
---

<div align="right">
  [![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdevlog-juneby.vercel.app%2Fposts%2FReact%2Frtk&count_bg=%233B82F6&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false)](https://hits.seeyoufarm.com)
</div>

# ğŸŒŸ ë„ì… ë°°ê²½

`FanUP`Â í”„ë¡œì íŠ¸ì—ì„œëŠ” ìƒíƒœê´€ë¦¬ë¥¼ ìœ„í•´Â `Redux Tool Kit`ì„ ì„ íƒí•˜ê³  ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì´ë²ˆ ê¸€ì—ì„œëŠ”Â `Redux Tool Kit`ì„ ì‚¬ìš©í•œ í›„ê¸°ì™€ ì‚¬ìš©ë²•ì— ëŒ€í•´ì„œ ì–˜ê¸°í•´ë³´ê² ìŠµë‹ˆë‹¤.

`Redux Tool Kit`ì„ ë„ì…í•œ ë°°ê²½ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒÂ `í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬`ì™€Â `ì„œë²„ ìƒíƒœ ê´€ë¦¬`ë¥¼ ëª¨ë‘ í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.
2. ì„œë²„ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ + í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë”°ë¡œ ì ìš©í•´ë„ ë˜ì§€ë§Œ,Â `Redux Tool Kit`Â ë¼ì´ë¸ŒëŸ¬ë¦¬ í•˜ë‚˜ë§Œìœ¼ë¡œë„, í´ë¼ì´ì–¸íŠ¸ ìƒíƒœê´€ë¦¬ì™€Â `RTK Query`ë¥¼ í†µí•œ ì„œë²„ ìƒíƒœê´€ë¦¬ê°€ ëª¨ë‘ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, ê¸°ìˆ ì˜ í†µì¼ì„±ì„ ìœ„í•˜ì—¬Â `Redux Tool Kit`ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
3. í”„ë¡œì íŠ¸ì˜ í´ë¼ì´ì–¸íŠ¸ ê°œë°œìë“¤ì´ ëª¨ë‘Â `Redux`Â ì‚¬ìš© ê²½í—˜ì´ ìˆê¸° ë•Œë¬¸ì—, í° ëŸ¬ë‹ ì»¤ë¸Œ ì—†ì´ ê°œë°œì„ ì§„í–‰ í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸ ìŠ¤í† ì–´ ì—°ê²°

`RTK Query`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ”,Â `RTK`ì—ì„œ ì œê³µí•˜ëŠ”Â `createApi`Â ë¥¼ ì´ìš©í•´, í•˜ë‚˜ì˜ ë„ë©”ì¸ì— ëŒ€í•œÂ `service`ë¥¼ ë§Œë“¤ê³ , ì´ë¥¼Â `combineReducer`ë¥¼ í†µí•´ ë§Œë“ Â `rootReducer`ì•  ì¶”ê°€í•˜ê³ ,Â `Redux`ì˜ configureStoreë¥¼ í†µí•´ ë§Œë“ Â `Root Store`ì™€ ì—°ê²° í•´ì•¼ í•©ë‹ˆë‹¤. ([RTK Query Overview](https://redux-toolkit.js.org/rtk-query/overview))

```tsx title="userService"
export const userApi = createApi({
  reducerPath: "userApi",
  baseQuery: customFetchBaseQuery,
  tagTypes: ["User", "SubScribedArtist", "MyTicket"],
  endpoints: (build) => ({
    getUser: build.query<IUser, void>({
      query: () => "/auth/me",
      providesTags: ["User"],
    }),
  }),
});
```

```tsx title="rootReducer"
const reducer = combineReducers({
  artistSlice,
  userSlice,
  [artistApi.reducerPath]: artistApi.reducer,
  [userApi.reducerPath]: userApi.reducer,
});
```

```tsx title="Root Store"
const store = configureStore({
  reducer,
  middleware: (getDefaultMiddleWare) =>
    getDefaultMiddleWare({ serializableCheck: false })
      .concat(artistApi.middleware)
      .concat(userApi.middleware),
});
```

<br />

# ğŸŒŸ Query ì‚¬ìš©í•˜ê¸°

`Query`ì˜ ê²½ìš°, ì„œë²„ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

`Store`ì— ì—°ê²°ì„ ëë‚¸ í›„,Â `createApi`Â ë©”ì„œë“œì˜Â `endPoint`Â `Key`ì— ì‘ì„±í•œÂ `Query`ì™€Â `Mutation`ì„ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
export const ticketApi = createApi({
  reducerPath: "ticketApi",
  baseQuery: customFetchBaseQuery,
  tagTypes: ["Ticket", "MyTicket", "TodayTicket", "TicketDetail"],
  endpoints: (build) => ({
    getTodayTickets: build.query<TicketSales[], void>({
      //TODO : invalidate when 00:00
      query: () => "/ticket/today",
      providesTags: ["TodayTicket"],
    }),
    getAllTickets: build.query<TicketSales[], void>({
      query: () => "/ticket",
      providesTags: ["Ticket"],
    }),
    getDetailTicket: build.query<TicketDetail, string>({
      query: (ticketid: string) => ({ url: `/ticket/${ticketid}` }),
      providesTags: (result, error, id) => [{ type: "TicketDetail", id }],
    }),
  }),
});

export const {
  useGetTodayTicketsQuery,
  useGetAllTicketsQuery,
  useGetDetailTicketQuery,
} = userApi;
```

`ì»´í¬ë„ŒíŠ¸`ì—ì„œ ì‚¬ìš©í•˜ê¸°(`Query`)

```tsx
const Tickets = () => {
  const { data: allTickets, isLoading } = useGetAllTicketsQuery(undefined, {
    pollingInterval: 3000,
    refetchOnMountOrArgChange: true,
  });
  return <></>;
};
```

ê¸°ë³¸ì ì¸Â `useQuery`Â `Hook`Â ì´ì™¸ì—ë„, ì—¬ëŸ¬ ìƒí™©ì—ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œÂ `Hook`ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤ =>Â [Queryì™€ ê´€ë ¨ëœ Hook ì‚´í´ë³´ê¸°](https://redux-toolkit.js.org/rtk-query/usage/queries)

ì—¬ëŸ¬ ê°€ì§€Â `Hook`ë“¤ì„ ì‚¬ìš©í•´,Â `Prefetch`,Â `Refetch`,Â `Lazy Fetch`Â ë“±,Â `Data Fetching`Â ì‹œì ì„ ì„ íƒí•˜ê³ ,Â `Data Fetching`Â ì‹œì ì„Â `Caching`Â í•´ ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ì¸Â `useQuery`ì˜ ê²½ìš°,Â `React Query`ì—ì„œ ì œê³µí•˜ëŠ”Â `useQuery`ì™€ ê±°ì˜ ê°™ì€ ë°˜í™˜ê°’ì„ ì œê³µí•˜ë©°, useQueryì˜ ë‘ë²ˆì§¸ ì¸ìì—Â `pollingInterval`,Â `refechOnFocus`Â ì™€ ê°™ì€ ì˜µì…˜ì„ í†µí•´, íŠ¹ì • ì‹œì ì— í•´ë‹¹Â `Query`ë¥¼ ë‹¤ì‹œÂ `Refetch`Â í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ->Â [useQueryì˜ ë°˜í™˜ê°’ê³¼ ì˜µì…˜ ì‚´í´ë³´ê¸°](https://redux-toolkit.js.org/rtk-query/usage/queries)

<br />

# ğŸŒŸ Mutation ì‚¬ìš©í•˜ê¸°

`Query`ê°€ ì„œë²„ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‚¬ìš© ë˜ì—ˆë‹¤ë©´,Â `Mutation`ì˜ ê²½ìš°, ì„œë²„ì˜ ìƒíƒœë¥¼ ë³€í™” ì‹œí‚¬ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```tsx
export const ticketApi = createApi({
  reducerPath: "ticketApi",
  baseQuery: customFetchBaseQuery,
  tagTypes: ["MyTicket"],
  endpoints: (build) => ({
    getMyTicket: build.query<MyTicket, string>({
      query: () => "/ticket/my",
      providesTags: ["MyTicket"],
    }),

    ticketing: build.mutation({
      query: (ticketId: string) => {
        return {
          url: "/ticket/user",
          method: "POST",
          body: { ticketId },
        };
      },
      invalidatesTags: (result, error, ticketId) => {
        if (result?.status >= 400 || error) return [];
        else return ["MyTicket"];
      },
    }),
  }),
});
```

ìœ„Â `ticket API`ì—ì„œÂ `ticketing mutation`ì€ í‹°ì¼“íŒ…ì„ í•˜ëŠ” ê²½ìš° ì‚¬ìš©ë Â `mutation`ì…ë‹ˆë‹¤.

`getMyTicket Query`ëŠ” ë‚´ê°€ í‹°ì¼“íŒ… í•œ í‹°ì¼“ì˜ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ”Â `Query`ì…ë‹ˆë‹¤.

ì‚¬ìš©ìê°€ í‹°ì¼“íŒ…ì„ ì„±ê³µí•œë‹¤ë©´, ë‚´ê°€ í‹°ì¼“íŒ…í•œ í‹°ì¼“ì˜ ëª©ë¡ì„ ì—…ë°ì´íŠ¸ ì‹œì¼œì¤˜ì•¼ í•©ë‹ˆë‹¤.

`invalidateTags`Â ì— ë“¤ì–´ê°€ëŠ” ë©”ì„œë“œëŠ”Â `result`,Â `error`,Â `params`Â ë¼ëŠ” 3ê°œì˜ ë§¤ê²Œë³€ìˆ˜ë¥¼ ë°›ìŠµë‹ˆë‹¤.

`result`ëŠ” ì‹¤í–‰ ê²°ê³¼ì— ëŒ€í•œ ì„œë²„ì˜ ì‘ë‹µì„ ë°›ê³ ,Â `error`ëŠ” ì‹¤í–‰ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ë©°,Â `params`ì—ëŠ”Â `mutation`ì˜ ë§¤ê²Œë³€ìˆ˜ë¡œ ì „ë‹¬í•œ ë°ì´í„°ê°€ ë°˜í™˜ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, í‹°ì¼“íŒ…ì´ ì„±ê³µ í–ˆì„ ë•Œë§Œ, ë‚´ê°€ í‹°ì¼“íŒ… í•œ í‹°ì¼“ì˜ ëª©ë¡ì„ ì—…ë°ì´íŠ¸(`invalidate`) ì‹œì¼œì£¼ë„ë¡ ë§Œë“¤ì–´, íš¨ìœ¨ì ìœ¼ë¡œ API ìš”ì²­ì„ ê´€ë¦¬ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸ Conditional Fetching

ìƒí™©ì— ë”°ë¼ì„œ, ì›í•˜ëŠ” ê²½ìš°ì—ë§ŒÂ `Query`ë¥¼ í†µí•œÂ `Data Fetching`ì„ í•˜ê³  ì‹¶ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

`FanUP`Â í”„ë¡œì íŠ¸ì—ì„œëŠ”,Â **ë‚´ê°€ í‹°ì¼“íŒ…í•œ í‹°ì¼“ì˜ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°**ê°€ ì´ì— í•´ë‹¹í–ˆìŠµë‹ˆë‹¤,.

ë¡œê·¸ì¸ì„ í•œ ì‚¬ìš©ìì— ëŒ€í•´ì„œë§Œ, ë‚´ê°€ í‹°ì¼“íŒ…í•œ í‹°ì¼“ì˜ ëª©ë¡ì„ ê°€ì ¸ì™€ì•¼ í–ˆìŠµë‹ˆë‹¤.

ì´ë•ŒëŠ”Â `useQuery`ì˜ ì˜µì…˜ ì¤‘Â `skip`ì„ ì´ìš©í•´ í•´ê²° í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```tsx
const { data: userData } = useGetUserQuery();
const { data: myTickets } = useGetMyTicketsQuery(undefined, {
  skip: userData ? false : true,
});
```

`skip`ì˜ ê°’ì— ë”°ë¼,Â `Query`ì˜ ì‹¤í–‰ ì—¬ë¶€ë¥¼ ê²°ì • í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ìì˜ ë°ì´í„°ê°€ ìˆë‹¤ë©´(ë¡œê·¸ì¸ì„ í•œ ê²½ìš°), í•´ë‹¹Â `Query`ë¥¼ ìˆ˜í–‰í•˜ê³ (`skip : false`), ë°ì´í„°ê°€ ì—†ë‹¤ë©´ í•´ë‹¹Â `Query`ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸCache Invalidate

ì•ì„œ,Â `mutation`ì— ëŒ€í•´ì„œ ì„¤ëª…ì„ í•  ë•Œ,Â `mutation`ë‚´ì—ì„œ,Â `invalidateTags`Â ë¥¼ í†µí•´ì„œ,Â `Query`ë¥¼Â `Refetch`í•˜ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ,Â `mutation`ì„ í†µí•´, ì„œë²„ì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ê²½ìš°ê°€ ì•„ë‹ ë•Œì—ë„,Â `Cache`ë¥¼Â `invalidate`Â ì‹œì¼œì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆì—ˆìŠµë‹ˆë‹¤.

`FanUP`Â ì„œë¹„ìŠ¤ì—ì„œëŠ”,Â `ë¡œê·¸ì•„ì›ƒ`ì„ í•˜ëŠ” ê²½ìš°ê°€ ê·¸ ê²½ìš°ì— í•´ë‹¹í–ˆìŠµë‹ˆë‹¤.

í† í°ì„ ì‚¬ìš©í•´, ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—, ë¡œê·¸ì•„ì›ƒì„ í•˜ëŠ” ê²½ìš°, ì„œë²„ì— íŠ¹ì • ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šê³ , í´ë¼ì´ì–¸íŠ¸ ìì²´ì ìœ¼ë¡œÂ `token`ì„ ë‚ ë ¤ì£¼ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ë¡œ,Â `Token`ì„ ë‚ ë ¤ì£¼ëŠ” ê²ƒ ì™¸ì—ë„, ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“ Â `API`ì˜Â `Cache`ë¥¼ ë‚ ë ¤ì£¼ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤

ì´ë•ŒëŠ”,Â `createApi`ì˜Â `util`í•¨ìˆ˜ì—ì„œ ì œê³µí•˜ëŠ”Â `resetApiState`Â ë©”ì„œë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

`resetApiState`ë¥¼ ì‚¬ìš©í•  ê²½ìš°, í•´ë‹¹ ë„ë©”ì¸ì— ë¬¶ì—¬ ìˆëŠ” ëª¨ë“ Â `Query`ê°€Â `Reset`Â ë˜ê²Œ ë©ë‹ˆë‹¤.

```tsx
export const userApi = createApi({
  reducerPath: "userApi",
  baseQuery: customFetchBaseQuery,
  tagTypes: ["User", "SubScribedArtist", "MyTicket"],
  endpoints: (build) => ({
    getUser: build.query<IUser, void>({
      query: () => "/auth/me",
      providesTags: ["User"],
    }),
    getMyTickets: build.query<MyTicket[], void>({
      query: () => "/ticket/my",
      providesTags: ["MyTicket"],
    }),
  }),
});

export const { useGetUserQuery, useGetMyTicketsQuery } = userApi;

export const { resetApiState: resetUserService } = userApi.util;
```

```tsx
const logout = useCallback(() => {
  if (!window.confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ì–´ìš”?")) return;
  localStorage.removeItem("token");
  dispatch(setToken(null));
  dispatch(resetUserService());
}, []);
```

`resetApi`ë¥¼ ì´ìš©í•´, ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“ Â `API`ì˜Â `Cache`ë¥¼Â `invalidate`Â ì‹œí‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸQueryê²°ê³¼ ê°€ê³µ

Queryë¥¼ í†µí•´ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê°€ê³µí•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” `transformResponse`ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì˜ˆì œëŠ” ì•„í‹°ìŠ¤íŠ¸ì˜ ìŠ¤ì¼€ì¥´ì„ ê°€ì ¸ì˜¨ ë’¤, í•´ë‹¹ ìŠ¤ì¼€ì¥´ì„ ë‹¬ë ¥ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” í˜•íƒœì˜ ë°ì´í„°ë¡œ ê°€ê³µí•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

```tsx
getSchedules: build.query<any[], CalendarData>({
    query: ({ calendarMonth, calendarYear }) =>
        `/ticket/artist/calendar?year=${calendarYear}&month=${calendarMonth}`,
    providesTags: ['Schedules'],
    transformResponse: (response: any[]) => {
        const temp: any[] = Array.from({ length: 31 }, () => []);
        response?.forEach((data) => {
            const startDate = new Date(data.startTime);
            const date = startDate.getDate();
            const [diff] = dateDiff(startDate, new Date());
            temp[date].push({ data, isPast: diff < 0 ? true : false });
        });

        return temp;
    },
}),

```

`Component`ì—ì„œëŠ” í•´ë‹¹Â `Query`ì˜ ê²°ê³¼ë¡œ ê°€ê³µëœ ë°ì´í„°ë¥¼ ë°›ì•„, ë°”ë¡œ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const {
  isLoading,
  data: schedules,
  isFetching,
} = useGetSchedulesQuery({
  calendarYear,
  calendarMonth,
});
```

<br />

# ğŸŒŸ FetchBaseQuery Header

`RTK Query`ì—ì„œëŠ”Â `axios`,Â `fetch`ë¥¼ ì‚¬ìš©í•´ ì„œë²„ì™€ í†µì‹ ì„ í•˜ì§€ ì•Šê³ ,Â `RTK`ì— ë‚´ì¥ ë˜ì–´ ìˆëŠ”Â `fetchBaseQuery`ë¥¼ ì´ìš©í•´, ì„œë²„ì™€ í†µì‹ ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.

`FanUP`ì—ì„œëŠ” ë¡œê·¸ì¸ í›„ ì„œë²„ì—ê²Œ ë°›ì€Â `token`ì„ í—¤ë”ì— ë„£ì–´, í†µì‹ ì„ ì§„í–‰í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´,Â `customFetchBaseQuery`ë¥¼ ë§Œë“¤ì–´, ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx
export const customFetchBaseQuery = fetchBaseQuery({
  baseUrl: process.env.REACT_APP_SERVER_URL,
  prepareHeaders: (headers, { getState }) => {
    const token = (getState() as any).userSlice.token;
    if (token) headers.set("Authorization", `Bearer ${token}`);
    return headers;
  },
});

export const userApi = createApi({
  reducerPath: "userApi",
  baseQuery: customFetchBaseQuery,
  tagTypes: ["User", "SubScribedArtist", "MyTicket"],
  endpoints: (build) => ({
    getUser: build.query<IUser, void>({
      query: () => "/auth/me",
      providesTags: ["User"],
    }),
  }),
});
```

`prepareHeaders`ì˜ ë‘ë²ˆ ì§¸ ë§¤ê²Œë³€ìˆ˜ë¥¼ í†µí•´, í´ë¼ì´ì–¸íŠ¸ ì „ì—­ ìŠ¤í† ì–´ì— ì ‘ê·¼ í•  ìˆ˜ ìˆì—ˆê³ , ì´ë¥¼ í†µí•´Â `header`ì—Â `token`ì„ ë„£ì€Â `baseQuery`ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br />

# ğŸŒŸ Loading state ì—†ì´ ì‚¬ìš©í•˜ê¸°

íŠ¹ì •Â `Query`ì— ëŒ€í•´ì„œëŠ”Â `loading`Â ìƒíƒœ ì—†ì´ ë°”ë¡œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. (ex, ì‚¬ìš©ì ì •ë³´)

ì´ëŸ´ ê²½ìš°,Â `HOC`Â íŒ¨í„´ì„ ì´ìš©í•´ì„œ,Â `Query`ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ í›„, ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§ ì‹œì¼œ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œÂ `loading state`ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```tsx
function withGetUser<P extends object>(Component: ComponentType<P>) {
  return function WihLoadingComponent({ ...props }) {
    const { isLoading } = useGetUserQuery();

    if (isLoading) return <></>;
    return <Component {...(props as P)} />;
  };
}
export default withGetUser;
```

```tsx
const Home = () => {
  const { data: userData } = useGetUserQuery();
  //isLoading ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥
  return (
    <>
      <Header />
      <BannerWrapper>
        <SubLogo />
        <h1>No Fan, No Artist</h1>
      </BannerWrapper>
      <UserContentsWrapper>
        {userData ? <FanFeatureBox /> : <div></div>}
        <ArtistsBox />
      </UserContentsWrapper>
    </>
  );
};

export default withGetUser(Home);
```

<br />

# ğŸŒŸ ì‚¬ìš© í›„ê¸°

ê¸°ì¡´ì—Â `React Query`ë¥¼ ì¦ê²¨ ì‚¬ìš© í–ˆì—ˆê³ , í° ë¶ˆí¸í•¨ì„ ëŠë¼ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì—, ì´ë²ˆ í”„ë¡œì íŠ¸ì—Â `RTK Query`ë¥¼ ì ìš©í•˜ê¸° ì´ì „ì—ëŠ”,Â `RTK Query`ì— ëŒ€í•œ ê±°ë¶€ê°ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ë‹ˆ,Â `React Query`ì˜ ê¸°ëŠ¥ì„ ê±°ì˜ ëŒ€ë¶€ë¶„ ì œê³µ í–ˆìŠµë‹ˆë‹¤. (ë¬¼ë¡  ì œê³µí•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ë„ ìˆì—ˆìŠµë‹ˆë‹¤)

ì˜¤íˆë ¤,Â `RTK Query`ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ, ì¢‹ì•˜ë˜ ì ë„ ìˆì—ˆìŠµë‹ˆë‹¤.

ë¨¼ì €, ì„œë²„ì™€ í†µì‹ í•˜ëŠ”Â `API`ë“¤ì„ íŠ¹ì • ë„ë©”ì¸ ë‹¨ìœ„ë¡œ ê´€ë¦¬ í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´, ì¢‹ì•˜ìŠµë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ, í´ë¼ì´ì–¸íŠ¸ ìŠ¤í† ì–´ì™€ ì—°ë™í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ë„ ìƒë‹¹íˆ ë§ˆìŒì— ë“¤ì—ˆìŠµë‹ˆë‹¤.

ì•ìœ¼ë¡œë„, ë„ë©”ì¸ ë³„ë¡œÂ `API`ë¥¼ ê´€ë¦¬í•˜ëŠ” ìƒí™©ì´ ë§ìœ¼ë©°, í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ë¥¼ í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ë§ë‹¤ë©´,Â `RTK Query`ë¥¼ ì‚¬ìš© í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.
